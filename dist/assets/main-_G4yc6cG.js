var O=d=>{throw TypeError(d)};var Y=(d,i,c)=>i.has(d)||O("Cannot "+c);var H=(d,i,c)=>i.has(d)?O("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(d):i.set(d,c);var C=(d,i,c)=>(Y(d,i,"access private method"),c);import{e as env}from"./env-DjWubmgd.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))h(v);new MutationObserver(v=>{for(const g of v)if(g.type==="childList")for(const f of g.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&h(f)}).observe(document,{childList:!0,subtree:!0});function c(v){const g={};return v.integrity&&(g.integrity=v.integrity),v.referrerPolicy&&(g.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?g.credentials="include":v.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function h(v){if(v.ep)return;v.ep=!0;const g=c(v);fetch(v.href,g)}})();function getDefaultExportFromCjs(d){return d&&d.__esModule&&Object.prototype.hasOwnProperty.call(d,"default")?d.default:d}var PathHelper$1={exports:{}};/**
 * PathHelper class
 * @author Mark Roland
 * @license Creative Commons Attribution-ShareAlike 4.0 International License
 */var hasRequiredPathHelper;function requirePathHelper(){return hasRequiredPathHelper||(hasRequiredPathHelper=1,function(d){var c,D,G,F;const f=class f{constructor(e=null){H(this,c);this.prng=e}info(e){let n={min:this.getMin(e),max:this.getMax(e),points:e.length};return n.range=[n.max[0]-n.min[0],n.max[1]-n.min[1]],n.center=[n.min[0]+n.range[0]/2,n.min[1]+n.range[1]/2],n}deepCopy(e){return JSON.parse(JSON.stringify(e))}pathsToFixed(e,n=2){return e.map(function(a){return a.map(function(l){return l.map(function(r){return parseFloat(r.toFixed(n))})})})}pathPointsArrayToObject(e){let n=[];for(let a of e)n.push({x:a[0],y:a[1]});return n}pathPointsObjectToArray(e){let n=[];for(let a of e)n.push([a.x,a.y]);return n}arrayColumn(e,n){return e.map(a=>a[n])}getMin(e){let n=this.arrayColumn(e,0),a=this.arrayColumn(e,1);if(e[0].length===3){let l=this.arrayColumn(e,2);return[this.arrayMin(n),this.arrayMin(a),this.arrayMin(l)]}return[this.arrayMin(n),this.arrayMin(a)]}getMax(e){let n=this.arrayColumn(e,0),a=this.arrayColumn(e,1);if(e[0].length===3){let l=this.arrayColumn(e,2);return[this.arrayMax(n),this.arrayMax(a),this.arrayMax(l)]}return[this.arrayMax(n),this.arrayMax(a)]}boundingBox(e){let n=this.getMin(e),a=this.getMax(e),l=[[n[0],a[0]],[n[1],a[1]]];return n.length===3&&a.length===3&&l.push([n[2],a[2]]),l}arrayMin(e){return Math.min(...e)}arrayMax(e){return Math.max(...e)}getRndInteger(e,n,a=null){return typeof a=="function"?Math.floor(a()*(n-e+1)+e):typeof this.prng=="function"?Math.floor(this.prng()*(n-e+1)+e):Math.floor(Math.random()*(n-e+1)+e)}getRandom(e=0,n=1,a=null){return typeof a=="function"?a()*(n-e)+e:typeof this.prng=="function"?this.prng()*(n-e)+e:Math.random()*(n-e)+e}getGaussianRandom(e=0,n=0,a=null){for(;e===0;)typeof a=="function"?e=a():e=this.getRandom(0,1,this.prng);for(;n===0;)typeof a=="function"?n=a():n=this.getRandom(0,1,this.prng);let l=Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*n);return l=l/10+.5,l>1||l<0?this.getGaussianRandom():l}map(e,n,a,l,r,s=!1){if(n==a)return l;(n<0||a<0)&&(a=a+-n,e=e+-n,n=n+-n);let o=l+(r-l)*((e-n)/(a-n));return s&&(o=this.clamp(o,l,r)),o}clamp(e,n,a){return Math.min(Math.max(e,n),a)}lerp(e,n,a){return e+(n-e)*a}degreesToRadians(e){return e*(Math.PI/180)}radiansToDegrees(e){return e*(180/Math.PI)}polarToRect(e,n){return[e*Math.cos(n),e*Math.sin(n)]}rectToPolar(e,n){return{radius:this.distance([0,0],[e,n]),theta:Math.atan2(n,e)}}greatestCommonDivisor(e,n){return n==0?e:this.greatestCommonDivisor(n,e%n)}sign(e){return e==0?0:e/Math.abs(e)}crossProduct(e,n){return[e[1]*n[2]-e[2]*n[1],e[2]*n[0]-e[0]*n[2],e[0]*n[1]-e[1]*n[0]]}dotProduct(e,n){let a=0;for(let l=0;l<e.length;l++)a+=e[l]*n[l];return a}matrixMultiply(e,n){if(e[0].length!=n.length)throw"Columns of Input A does not match Rows of Input B in matrixMultiply";let a=[];for(let l=0;l<e.length;l++){a[l]=[];for(let r=0;r<n[0].length;r++){let s=0;for(let o=0;o<e[0].length;o++)s+=e[l][o]*n[o][r];a[l][r]=s}}return a}lineSlopeIntercept(e,n){let a=(n[1]-e[1])/(n[0]-e[0]),l=e[1]-a*e[0];return{m:a,b:l}}solveQuadratic(e,n,a){let l=Math.pow(n,2)-4*e*a;if(l===0)return[-n/(2*e)];if(l>0){let r=(-n+Math.sqrt(l))/(2*e),s=(-n-Math.sqrt(l))/(2*e);return[r,s]}return[]}distance(e,n){return e.length==3&&n.length==3?Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2)):Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2))}midpoint(e,n){return[this.lerp(e[0],n[0],.5),this.lerp(e[1],n[1],.5)]}angle(e,n,a){let l,r=this.distance(n,a),s=this.distance(e,n),o=this.distance(a,e),u=(Math.pow(r,2)+Math.pow(s,2)-Math.pow(o,2))/(2*r*s);return u=u.toFixed(8),Math.abs(u)>1?(console.log("Invalid acos() argument: "+u+". Points may be collinear."),0):(l=Math.acos(u),l)}curvature(e,n,a){let l=this.angle(e,n,a);return 2*Math.sin(l)/this.distance(e,a)}polygon(e,n,a=0){let l=[],r=0;for(let s=0;s<=e;s++)r=s/e*(2*Math.PI),l.push([n*Math.cos(r+a),n*Math.sin(r+a)]);return l}rectangle(e,n){return[[-e/2,-n/2],[e/2,-n/2],[e/2,n/2],[-e/2,n/2],[-e/2,-n/2]]}ellipse(e,n,a=60){let l=[];for(let r=0;r<a;r++){let s=r/a*2*Math.PI;l.push([e*Math.cos(s),n*Math.sin(s)])}return l.push(l[0]),l}superellipse(e,n,a=60){let l=[];for(let r=0;r<=a;r++){let s=r/a*2*Math.PI,o=Math.pow(Math.abs(Math.cos(s)),2/a)*e*this.sign(Math.cos(s)),u=Math.pow(Math.abs(Math.sin(s)),2/a)*n*this.sign(Math.sin(s));l.push([o,u])}return l}star(e=5,n=1,a=.5){let l=[],r=e*2;for(let s=0;s<r;s++){let o=n,u=s/r*2*Math.PI;s%2==1&&(o=a),l.push([o*Math.cos(u),o*Math.sin(u)])}return l.push(l[0]),l}parabola(e,n,a){let l=[];for(let r=0;r<=a;r++){let s=this.map(r,0,a,-n/2,n/2),o=e*Math.pow(s,2);l.push([s,o])}return l}arcPointToPoint(e,n,a,l,r,s=12){let o=[],u=Math.atan2(l-n,a-e),p=this.distance([e,n],[a,l]);for(let m=1;m<s;m++)o.push([e+(a-e)/2+p/2*Math.cos(u+Math.PI+m/s*r),n+(l-n)/2+p/2*Math.sin(u+Math.PI+m/s*r)]);return o}arc(e,n,a,l,r){let s=[];for(let o=0;o<=r;o++)s.push([e[0]+n*Math.cos(l+o/r*a),e[1]+n*Math.sin(l+o/r*a)]);return s}quadraticBezierPath(e,n,a,l){let r=[];for(let s=0;s<=l;s++){let o=s/l;r.push([Math.pow(1-o,2)*e[0]+2*(1-o)*o*n[0]+Math.pow(o,2)*a[0],Math.pow(1-o,2)*e[1]+2*(1-o)*o*n[1]+Math.pow(o,2)*a[1]])}return r}cubicBezierPath(e,n,a,l,r){let s=[];for(let o=0;o<=r;o++){let u=o/r;s.push([Math.pow(1-u,3)*e[0]+3*Math.pow(1-u,2)*u*n[0]+3*(1-u)*Math.pow(u,2)*a[0]+Math.pow(u,3)*l[0],Math.pow(1-u,3)*e[1]+3*Math.pow(1-u,2)*u*n[1]+3*(1-u)*Math.pow(u,2)*a[1]+Math.pow(u,3)*l[1]])}return s}centerPaths(e){let n,a,l,r,s,o;for(let b=0;b<e.length;b++){let S=this.arrayColumn(e[b],0);n=Math.min(...S),(typeof a>"u"||n<a)&&(a=n),n=Math.max(...S),(typeof l>"u"||n>l)&&(l=n);let w=this.arrayColumn(e[b],1);r=Math.min(...w),(typeof s>"u"||r<s)&&(s=r),r=Math.max(...w),(typeof o>"u"||r>o)&&(o=r)}let u=l-a,p=a+u/2,m=o-s,_=s+m/2;for(let b=0;b<e.length;b++)e[b]=this.translatePath(e[b],[-p,-_]);return e}scalePath(e,n){let a=n,l=n,r=n;return n.length!==void 0&&(a=n[0],l=n[1],r=n[2]!==void 0?n[2]:1),e.map(function(s){let o=[s[0]*a,s[1]*l];return s.length==3&&o.push(s[2]*r),o})}translatePath(e,n){return e.map(function(a){return[a[0]+n[0],a[1]+n[1]]})}rotatePath(e,n,a=[0,0]){return e.map(function(l){return this.rotatePoint(l,n,a)},this)}rotatePoint(e,n,a=[0,0]){return[(e[0]-a[0])*Math.cos(n)-(e[1]-a[1])*Math.sin(n)+a[0],(e[0]-a[0])*Math.sin(n)+(e[1]-a[1])*Math.cos(n)+a[1]]}reflectPath(e,n,a=0){return e.map(function(l){return n=="x"||n=="horizontal"?[-(l[0]-a)+a,l[1]]:n=="y"||n=="vertical"?[l[0],-(l[1]-a)+a]:l})}shearPath(e,n,a,l=!1){const r=e[0];let s=[[1,0],[a,1]];n=="vertical"&&(s=[[1,a],[0,1]]);const o=this;return e=e.map(function(u){let p;try{p=o.matrixMultiply([u],s)[0]}catch(m){console.log(m)}return p}),l&&(e=this.translatePath(e,[-[e[0][0]-r[0]],-[e[0][1]-r[1]]])),e}distortPath(e,n,a){if(a.length!=4)return console.log("distortion array length must be four."),[];let l=[];const r=this.info(n);for(let s=0;s<e.length;s++){let o=(e[s][0]-r.min[0])/r.range[0],u=(e[s][1]-r.min[1])/r.range[1],p=[this.lerp(a[0][0],a[1][0],o),this.lerp(a[0][1],a[1][1],o)],m=[this.lerp(a[3][0],a[2][0],o),this.lerp(a[3][1],a[2][1],o)],_=[this.lerp(p[0],m[0],u),this.lerp(p[1],m[1],u)];l.push(_)}return l}booleanAdd(e,n){this.pointEquals(e[e.length-1],e[0],1e-4)||e.push(e[0]),this.pointEquals(n[n.length-1],n[0],1e-4)||n.push(n[0]);let a=this.shapeIntersections(e,n),l=this.shapeIntersections(n,e),r=[];return r=r.concat(this.booleanAddComparison(a,n)),r=r.concat(this.booleanAddComparison(l,e)),r=this.joinPaths(r),r}booleanAddComparison(e,n){let a=[],l=C(this,c,F).call(this,n),r=[],s=e.length-1;for(let o=0;o<s;o++){let u=[this.lerp(e[o][0],e[o+1][0],.5),this.lerp(e[o][1],e[o+1][1],.5)];this.pointInPolygon(l,u[0],u[1])?(r.push(e[o]),r.length>1&&a.push(r),r=[]):r.push(e[o]),o==s-1&&r.push(e[o+1])}return r.length>1&&a.push(r),a}booleanSubtract(e,n){this.pointEquals(e[e.length-1],e[0],1e-4)||e.push(e[0]),this.pointEquals(n[n.length-1],n[0],1e-4)||n.push(n[0]);let a=this.shapeIntersections(e,n),l=this.shapeIntersections(n,e),r=[];return r=r.concat(this.booleanSubtractComparison(a,n)),r=r.concat(this.booleanSubtractComparison(l,e,!0)),r=this.joinPaths(r),r}booleanSubtractComparison(e,n,a=!1){let l=[],r=C(this,c,F).call(this,n),s=[],o=e.length-1;for(let u=0;u<o;u++){let p=[this.lerp(e[u][0],e[u+1][0],.5),this.lerp(e[u][1],e[u+1][1],.5)];a?(this.pointInPolygon(r,p[0],p[1],-1e-5)?s.push(e[u]):(s.push(e[u]),s.length>1&&l.push(s),s=[]),u==o-1&&s.push(e[u+1])):(this.pointInPolygon(r,p[0],p[1],1e-5)?(s.push(e[u]),s.length>1&&l.push(s),s=[]):s.push(e[u]),u==o-1&&s.push(e[u+1]))}return s.length>1&&l.push(s),l}booleanIntersect(e,n){this.pointEquals(e[e.length-1],e[0],1e-4)||e.push(e[0]),this.pointEquals(n[n.length-1],n[0],1e-4)||n.push(n[0]);let a=this.shapeIntersections(e,n),l=this.shapeIntersections(n,e),r=[];return r=r.concat(this.booleanIntersectionComparison(a,n)),r=r.concat(this.booleanIntersectionComparison(l,e)),r=this.joinPaths(r),r}booleanIntersectionComparison(e,n){let a=[],l=C(this,c,F).call(this,n),r=[],s=e.length-1;for(let o=0;o<s;o++){let u=[this.lerp(e[o][0],e[o+1][0],.5),this.lerp(e[o][1],e[o+1][1],.5)];this.pointInPolygon(l,u[0],u[1])?r.push(e[o]):(r.push(e[o]),r.length>1&&a.push(r),r=[]),o==s-1&&r.push(e[o+1])}return r.length>1&&a.push(r),a}shapeIntersections(e,n){let a=[];for(let l=0;l<e.length-1;l++){a.push(e[l]);let r=[];for(let s=0;s<n.length-1;s++){if(this.pointOnLineSegment(n[s],[e[l],e[l+1]],1e-7)){r.push(n[s]);continue}let u=this.getLineLineCollision({x:e[l][0],y:e[l][1]},{x:e[l+1][0],y:e[l+1][1]},{x:n[s][0],y:n[s][1]},{x:n[s+1][0],y:n[s+1][1]});u&&r.push([u.x,u.y])}if(r.length>0){let s=this;r.sort(function(o,u){return s.distance(e[l],o)>s.distance(e[l],u)?1:-1}),a=a.concat(r)}}return a.push(e[e.length-1]),a}pathLength(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}lineEquals(e,n,a=0){return!!(this.pointEquals(e[0],n[0],a)&&this.pointEquals(e[1],n[1],a))}pointEquals(e,n,a=0){return a===0&&e[0]===n[0]&&e[1]===n[1]?!0:this.distance(e,n)<=a}closedPath(e,n=1e-4){return e.length<3?!1:!!this.pointEquals(e[e.length-1],e[0],n)}selfIntersectingPath(e){for(let n=0;n<e.length-2;n++){const a=[e[n],e[n+1]];for(let l=n+2;l<e.length-1;l++){const r=[e[l],e[l+1]];if(this.getLineLineCollision({x:a[0][0],y:a[0][1]},{x:a[1][0],y:a[1][1]},{x:r[0][0],y:r[0][1]},{x:r[1][0],y:r[1][1]})!==!1)return!0}}return!1}simplePolygon(e){return!(!this.closedPath(e)||this.selfIntersectingPath(e))}complexPolygon(e){return!!(this.closedPath(e)&&this.selfIntersectingPath(e))}convexPolygon(e){if(!this.simplePolygon(e))throw"The Path is not a simple polygon.";let n=0,a=0;for(let l=1;l<e.length;l++){const r=e[l-1],s=e[l],o=e[l+2];let u=[r[0]-s[0],r[1]-s[1],0],p=[o[0]-s[0],o[1]-s[1],0];if(this.crossProduct(u,p)[2]>0?n=1:n=-1,l>1&&n!=a)return!1;a=n}return!0}concavePolygon(e){return!this.convexPolygon(e)}intersect_point(e,n,a,l){const r=((l[0]-a[0])*(e[1]-a[1])-(l[1]-a[1])*(e[0]-a[0]))/((l[1]-a[1])*(n[0]-e[0])-(l[0]-a[0])*(n[1]-e[1])),s=((n[0]-e[0])*(e[1]-a[1])-(n[1]-e[1])*(e[0]-a[0]))/((l[1]-a[1])*(n[0]-e[0])-(l[0]-a[0])*(n[1]-e[1]));if(r<0||r>1||s<0||s>1)return null;const o=e[0]+r*(n[0]-e[0]),u=e[1]+r*(n[1]-e[1]);return[o,u]}getLineLineCollision(e,n,a,l){const r=this.intersect_point([e.x,e.y],[n.x,n.y],[a.x,a.y],[l.x,l.y]);return r?{x:r[0],y:r[1]}:!1}lineCircleIntersect(e,n,a){const l={x:e[0],y:e[1]},r={x:n[0],y:n[1]},s=[a[0][0],a[0][1]],o=a[1],u=r.x-l.x,p=r.y-l.y,m=u*u+p*p,_=2*(u*(l.x-s[0])+p*(l.y-s[1])),b=(l.x-s[0])*(l.x-s[0])+(l.y-s[1])*(l.y-s[1])-o*o,S=_*_-4*m*b;if(S<0)return!1;const w=(-_+Math.sqrt(S))/(2*m),P=(-_-Math.sqrt(S))/(2*m),q=[];return S===0?w>=0&&w<=1&&q.push([l.x+w*u,l.y+w*p]):(w>=0&&w<=1&&q.push([l.x+w*u,l.y+w*p]),P>=0&&P<=1&&q.push([l.x+P*u,l.y+P*p])),q.length>0?q:!1}circleInterceptPoints(e,n,a,l,r){let s=this.distance(e,a),o=1/2*(e[0]+a[0])+(Math.pow(n,2)-Math.pow(l,2))/(2*Math.pow(s,2))*(a[0]-e[0])+r*(1/2)*Math.sqrt(2*((Math.pow(n,2)+Math.pow(l,2))/Math.pow(s,2))-Math.pow(Math.pow(n,2)-Math.pow(l,2),2)/Math.pow(s,4)-1)*(a[1]-e[1]),u=1/2*(e[1]+a[1])+(Math.pow(n,2)-Math.pow(l,2))/(2*Math.pow(s,2))*(a[1]-e[1])+r*(1/2)*Math.sqrt(2*((Math.pow(n,2)+Math.pow(l,2))/Math.pow(s,2))-Math.pow(Math.pow(n,2)-Math.pow(l,2),2)/Math.pow(s,4)-1)*(e[0]-a[0]);return[o,u]}pointOnLineSegment(e,n,a=.01){let l=this.distance(e,n[0]),r=this.distance(e,n[1]),s=this.distance(n[0],n[1]);return l+r>=s-a&&l+r<=s+a}pointInPolygon(e,n,a,l=-1e-5){let r=!1,s=0;for(let o=0;o<e.length;o++){s=o+1,s==e.length&&(s=0);let u=e[o],p=e[s],m=u.y>=a&&p.y<a||u.y<a&&p.y>=a,_=(p.x-u.x)*(a-u.y)/(p.y-u.y)+u.x;if(m&&n<_&&(r=!r),this.pointOnLineSegment([n,a],[[u.x,u.y],[p.x,p.y]],Math.abs(l)))return l>0}return r}parallelPath(e,n,a){let l=n[1]-e[1],r=n[0]-e[0],s=Math.atan2(l,r);const o=e[0]+a*Math.cos(s+Math.PI/2),u=e[1]+a*Math.sin(s+Math.PI/2),p=e.length==3?[e[2]]:[];let m=[e,[o,u,...p]];const _=n[0]+a*Math.cos(s+Math.PI/2),b=n[1]+a*Math.sin(s+Math.PI/2),S=e.length==3?[n[2]]:[];let w=[n,[_,b,...S]];return[m[1],w[1]]}expandPath(e,n,a,l="open"){let r=[],s=[],o,u=n,p=e.length-1;s=[];for(let _=0;_<p;_++)u=n+(a-n)*(_/p),o=this.parallelPath(e[_],e[_+1],u),s.push(o[0]);o=this.parallelPath(e[e.length-2],e[e.length-1],a),s.push(o[1]),r.push(s),s=[];for(let _=0;_<p;_++)u=n+(a-n)*(_/p),o=this.parallelPath(e[_],e[_+1],-u),s.push(o[0]);o=this.parallelPath(e[e.length-2],e[e.length-1],-a),s.push(o[1]),r.push(s);let m;switch(l){case"flat":return m=r[0].concat(r[1].reverse()),m.push(r[0][0]),[m];case"round":return r[1].reverse(),m=r[0],m=m.concat(this.arcPointToPoint(r[0][r[0].length-1][0],r[0][r[0].length-1][1],r[1][0][0],r[1][0][1],-Math.PI,6)),m=m.concat(r[1]),m=m.concat(this.arcPointToPoint(r[1][r[1].length-1][0],r[1][r[1].length-1][1],r[0][0][0],r[0][0][1],-Math.PI,6)),m.push(r[0][0]),[m];default:return r}}varyPath(e,n,a=0,l=0,r=7,s=!0,o=null){let u=e;const p=n;let m=this.dividePathComplete(e,p),_=[];if(e[0].length==3){const P=e.length-1;for(let q=0;q<e.length;q++)_.push([q/P,e[q][2]]);_=this.dividePathComplete(_,p)}if(!_.length){let P=this.noisify([[0,0],[1,0]],l,a,!1,!1,0,1,!0,!0);if(r<3&&(r=3),s)for(let q=0;q<r;q++)P[q][1]=0,P[P.length-(q+1)][1]=0;for(let q=0;q<5;q++)P=this.smoothPath(P,r,"extrapolate")}const b=this.info(_),S=Math.max(Math.abs(b.max[1]),Math.abs(b.min[1])),w=Math.ceil(S/n);for(let P=1;P<=w;P++){let q=P/w,I=this.offsetPath(m,function(T){let $=Math.floor(T*(_.length-1));return q*_[$][1]});I.pop(),I=I.reverse(),u=u.concat(I);let L=this.offsetPath(m,function(T){let $=Math.floor(T*(_.length-1));return-(q*_[$][1])});L.pop(),u=u.concat(L)}return o>0&&(u=this.simplify(u,o)),u}offsetPath(e,n,a=!1){if(e.length<3)throw"Input path must contain 3 or more points";let l=[],r=JSON.parse(JSON.stringify(e));if(this.distance(r[0],r[r.length-1])<1e-4){r.pop();let s=r.length;for(let o=0;o<s;o++){let u=(o+1)%r.length,p=(o+2)%r.length,m;typeof n=="function"?m=n(o/s):m=n;let _=this.offsetAngle(r[o],r[u],r[p],-m);l.push(_[1])}l.push(l[0])}else{let s=r.length-3;for(let o=0;o<=s;o++){let u=o+1,p=o+2,m;typeof n=="function"?m=n(o/s):m=n;let _=this.offsetAngle(r[o],r[u],r[p],-m);o===0?(l.push(_[0]),l.push(_[1])):o===s?(l.push(_[1]),l.push(_[2])):l.push(_[1])}}return isNaN(l[l.length-1][0])&&(console.log("NaN Error in PathHelper.offsetPath()"),console.log(l)),a&&(l=this.removeKnots(l)),l}morph(e,n,a){if(a<0||a>1)throw"percent argument must be between 0.0 and 1.0 in PathHelper.morph()";const l=new f,r=10*Math.max(e.length,n.length);let s=this.resamplePath(e,r),o=this.resamplePath(n,r);if(s.length!=o.length)throw"Paths are not the same length in PathHelper.morph()";let u=[];const p=s.length;for(let m=0;m<p;m++)u.push([l.lerp(s[m][0],o[m][0],a),l.lerp(s[m][1],o[m][1],a)]);return u}removeKnots(e){if(e.length<3)throw"Input path must contain 3 or more points";let n=0,a=e.slice(0,3);for(let l=2;l<e.length-1;l++){let r=e.slice(n,l);const s=[e[l],e[l+1]];for(let o=n;o<r.length-1;o++){let u=this.getLineLineCollision({x:s[0][0],y:s[0][1]},{x:s[1][0],y:s[1][1]},{x:r[o][0],y:r[o][1]},{x:r[o+1][0],y:r[o+1][1]});if(u==!1){a.push(e[l]);continue}else return a=r.slice(0,o+1),a.push([u.x,u.y]),l+2<e.length&&a.push(e[l+2]),n=l+1,a=a.concat(e.slice(l+3)),a=this.removeKnots(a),a}}return a}offsetAngle(e,n,a,l){let r=this.angle(e,n,a),s=l*Math.tan(Math.PI/2-.5*r),o=this.parallelPath(e,n,l),u=[e[0]-n[0],e[1]-n[1],0],p=[a[0]-n[0],a[1]-n[1],0];this.crossProduct(u,p)[2]<0&&(s=s*-1),o=this.extendLine(o[0],o[1],0,s);let _=this.parallelPath(n,a,l),b=o;return b.push(_[1]),b}extendLine(e,n,a,l){if(e.length==3&&n.length==3)return C(this,c,G).call(this,e,n,a,l);let r=Math.atan2(n[1]-e[1],n[0]-e[0]),s=[e[0]-a*Math.cos(r),e[1]-a*Math.sin(r)],o=[n[0]+l*Math.cos(r),n[1]+l*Math.sin(r)];return[s,o]}extendPath(e,n=1){const a=new f;let l=a.deepCopy(e);const r=e.length-1;let s=a.distance(e[r],e[r-1]),o;if(typeof e[r-2]<"u"){const p=e[r-2],m=e[r-1],_=e[r];let b=Math.atan2(m[1]-_[1],m[0]-_[0]),S=a.angle(e[r-2],e[r-1],e[r]);S=n*S;const w=[p[0]-m[0],p[1]-m[1],0],P=[_[0]-m[0],_[1]-m[1],0];a.crossProduct(w,P)[2]<0&&(S=S*-1),o=b+S}else o=Math.atan2(e[r-1][1]-e[r][1],e[r-1][0]-e[r][0])+Math.PI;let u=[e[r][0]+s*Math.cos(o),e[r][1]+s*Math.sin(o)];return l.push(u),l}limitPathDistance(e,n){let a=0,l=[e[0]];for(let r=1;r<e.length;r++){let s=Math.hypot(e[r][0]-e[r-1][0],e[r][1]-e[r-1][1]);if(a+s<n)l.push(e[r]),a+=s;else{let o=a+s-n,u=this.extendLine(e[r-1],e[r],0,-o);return l.push(u[1]),l}}return l}superimposeFunction(e,n){if(typeof n!="function")throw"fn parameter must be a function";let a=[],l=0;for(let o=0;o<e.length-1;o++){let u=[e[o],e[o+1]],p=this.distance(u[0],u[1]);l+=p}let r=0;const s=e.length-1;for(let o=0;o<=s;o++){let u,p;o==s?(u=e[o],p=e[o-1]):(u=e[o],p=e[o+1]),o>0&&(r+=this.distance(u,p));let m=n(r/l),_=p[1]-u[1],b=p[0]-u[0],S=Math.atan2(_,b);a.push([u[0]+m*Math.cos(S+Math.PI/2),u[1]+m*Math.sin(S+Math.PI/2)])}return a}noisify(e,n,a,l=!1,r=!1,s=0,o=1,u=!1,p=!0){let m=this.dividePathComplete(e,n),_=[],b=0;u&&(_.push(m[0]),b=1);let S=m.length-1;for(let w=b;w<S;w++){let P;l?P=this.getGaussianRandom()*a:P=this.getRandom(-a,a);let q=m[w+1][1]-m[w][1],I=m[w+1][0]-m[w][0],L=Math.atan2(q,I);_.push([m[w][0]+P*Math.cos(L+Math.PI/2),m[w][1]+P*Math.sin(L+Math.PI/2)])}if(p)_.push(m[m.length-1]);else{let w=m[m.length-1],P;l?P=this.getGaussianRandom()*a:P=this.getRandom(-a,a);let q=m.length-1,I=m[q][1]-m[q-2][1],L=m[q][0]-m[q-2][0],T=Math.atan2(I,L);w=[m[q][0]+P*Math.cos(T+Math.PI/2),m[q][1]+P*Math.sin(T+Math.PI/2)],_.push(w)}if(r&&(this.pointEquals(_[0],_[_.length-1])||_.push(_[0])),s>1)for(let w=0;w<o;w++)_=this.smoothPath(_,s);return _}smoothPath(e,n=3,a="preserve"){if(n<3)throw"Smoothing window size should be greater than or equal to 3.";if(!["preserve","weight","extrapolate","trim"].includes(a))throw'"boundary" parameter must be one of: preserve, weight, extrapolate, trim';if(e.length<n)return e;let l=!1;this.pointEquals(e[0],e[e.length-1])&&(l=!0);let r=[],s=1/n;const o=new Array(n).fill(s);let u=(n-1)/2;if(a=="weight"){let _=Math.floor(n/2);e=new Array(_).fill(e[0]).concat(e),e=e.concat(new Array(_).fill(e[e.length-1]))}else if(a=="extrapolate"){const _=Math.floor(n/2);let b=this.distance(e[0],e[1]),S=Math.atan2(e[0][1]-e[_][1],e[0][0]-e[_][0]);for(let I=0;I<_;I++)e=[[e[0][0]+b*Math.cos(S),e[0][1]+b*Math.sin(S)]].concat(e);const w=e.length-1;let P=this.distance(e[w],e[w-1]),q=Math.atan2(e[w][1]-e[w-_][1],e[w][0]-e[w-_][0]);for(let I=0;I<_;I++){let L=[e[e.length-1][0]+P*Math.cos(q),e[e.length-1][1]+P*Math.sin(q)];e.push(L)}}let p=0,m=e.length-1;l||(p+=u,m=e.length-u,a=="preserve"&&r.push(e[0]));for(let _=p;_<m;_++){let b=[0,0];for(let S=-u;S<=u;S++){let w=_+S;if(l)w=(e.length-1+(_+S))%(e.length-1);else if(w<0||w>e.length-1)continue;b[0]+=e[w][0]*o[S+u],b[1]+=e[w][1]*o[S+u]}r.push(b)}return l?r.push(r[0]):a=="preserve"&&r.push(e[e.length-1]),r}smoothCorners(e,n,a=20){if(n>=1)return e;n<0&&(n=0);let l=!1;this.pointEquals(e[0],e[e.length-1])&&(l=!0);let r=this.map(n,0,1,.5,1),s=[],o=0;l||(s.push(e[0]),o+=1);for(let u=o;u<e.length-1;u++){let p=u-1,m=u,_=u+1;l&&(p=(e.length-1+(u-1))%(e.length-1),m=u,_=(e.length-1+(u+1))%(e.length-1));let b=e[p],S=e[m],w=e[_],P=[this.lerp(b[0],S[0],r),this.lerp(b[1],S[1],r)],q=[this.lerp(w[0],S[0],r),this.lerp(w[1],S[1],r)],I=this.cubicBezierPath(P,S,S,q,a);r===.5&&I.pop(),s=s.concat(I)}return l?s.push(s[0]):s.push(e[e.length-1]),s}radiusCorners(e,n,a=20){let l=!1;this.pointEquals(e[0],e[e.length-1])&&(l=!0);let r=[],s=0;l||(r.push(e[0]),s+=1);for(let o=s;o<e.length-1;o++){let u=o-1,p=o,m=o+1;l&&(u=(e.length-1+(o-1))%(e.length-1),p=o,m=(e.length-1+(o+1))%(e.length-1));let _=e[u],b=e[p],S=e[m],w=this.distance(_,b),P=[this.lerp(_[0],b[0],(w-n)/w),this.lerp(_[1],b[1],(w-n)/w)],q=this.distance(S,b),I=[this.lerp(S[0],b[0],(q-n)/q),this.lerp(S[1],b[1],(q-n)/q)],L=this.cubicBezierPath(P,b,b,I,a);r=r.concat(L)}return l?r.push(r[0]):r.push(e[e.length-1]),r}shiftPath(e,n){if(e.length>n)e.unshift(...e.splice(-n));else{let a=0;for(;a<n;)e.unshift(e.splice(-1)),a++}return e}subdividePath(e){let n=[];for(let a=0;a<e.length-1;a++)n.push(e[a]),n.push([e[a][0]+(e[a+1][0]-e[a][0])/2,e[a][1]+(e[a+1][1]-e[a][1])/2]);return n.push(e[e.length-1]),n}dividePath(e,n){let a=[];const l=e[0],r=e[1];for(let s=0;s<=n;s++)a.push([this.lerp(l[0],r[0],s/n),this.lerp(l[1],r[1],s/n)]);return a}dividePathComplete(e,n){let a=[];for(let l=0;l<e.length-1;l++){let r=[e[l],e[l+1]],s=this.distance(r[0],r[1]);if(s>n){let o=Math.ceil(s/n),u=this.dividePath(r,o);u.pop(),a=a.concat(u)}else a.push(r[0])}return a.push(e[e.length-1]),a}explodePath(e){if(e.length<2)throw"Path must have at least 2 points.";let n=[];for(let a=0;a<e.length-1;a++)n.push([e[a],e[a+1]]);return n}resamplePath(e,n){let a=[0],l=this.pathLength(e);for(let o=1;o<e.length-1;o++)a.push(this.pathLength(e.slice(0,o+1))/l);a.push(1);let r=[e[0]],s=n-1;for(let o=1;o<s;o++){let u=o/s,p=C(this,c,D).call(this,a,u),m=(u-a[p])/(a[p+1]-a[p]),_=[this.lerp(e[p][0],e[p+1][0],m),this.lerp(e[p][1],e[p+1][1],m)];r.push(_)}return r.push(e[e.length-1]),r}filterPath(e,n,a=!0){if(typeof n!="function")throw"Argument 2 is not a function in PathHelper.filterPath()";let l=[],r=[];for(let s=0;s<e.length;s++){const o=e[s];n.call(this,o,s)?r.push(o):a&&r.length>1&&(l.push(r),r=[])}return r.length>1&&l.push(r),l}filterPaths(e,n,a=!0){let l=[];for(let r of e)l=l.concat(this.filterPath(r,n,a));return l}dashPath(e,n,a,l=!1){let r={dashes:[],gaps:[]},s=[],o=Math.min(n,a)/3;for(let b=0;b<e.length-1;b++){let S=this.dividePathComplete([e[b],e[b+1]],o);S.pop(),s=s.concat(S)}s.push(e[e.length-1]);let u=!0,p=u?n:a,m=[s[0]];const _=s.length-1;for(let b=0;b<_;b++){let S=this.distance(m[m.length-1],s[b+1]);if(p-=S,p>0)m.push(s[b+1]);else{const w=this.extendLine(m[m.length-1],s[b+1],0,p);m.push(w[1]),u?r.dashes.push(m):r.gaps.push(m),m=[w[1]],u=!u,p=u?n:a}}return m.length>0&&(u?r.dashes.push(m):r.gaps.push(m)),l?r.gaps:r.dashes}decimatePath(e,n=.05){let a=[],l=[];for(let r=0;r<e.length;r++){if(this.getRandom(0,1,this.prng)<n){l.length>1&&a.push(l),l=[];continue}l.push(e[r])}return l.length>1&&a.push(l),a}decimatePaths(e,n=.05){let a=[];for(let l=0;l<e.length;l++){let r=this.decimatePath(e[l],n);r.length>=1&&(a=a.concat(r))}return a}joinPaths(e,n=.01,a=0,l=0){l++;let r=a,s;for(let p=r;p<e.length;p++){let m=!1;if(s=this.distance(e[r][0],e[r][e[r].length-1]),s<n&&(m=!0),m){r++;continue}break}if(r==e.length)return e;let o=e[r][e[r].length-1],u=0;for(let p=0;p<e.length;p++)if(p!=r){if(s=this.distance(o,e[p][0]),s<n){u++,e[r]=e[r].concat(e[p].slice(1)),e.splice(p,1);break}if(s=this.distance(o,e[p][e[p].length-1]),s<n){u++,e[r]=e[r].concat(e[p].reverse().slice(1)),e.splice(p,1);break}if(s=this.distance(e[r][0],e[p][0]),s<n){u++,e[r]=e[p].reverse().concat(e[r]),e.splice(p,1);break}if(s=this.distance(e[r][0],e[p][e[p].length-1]),s<n){u++,e[r]=e[p].concat(e[r]),e.splice(p,1);break}}return r==e.length||(u===0&&a++,e=this.joinPaths(e,n,a,l),e[0]=this.cleanPath(e[0],1e-4)),e}cleanPath(e,n=1e-4){let a=[];a.push(e[0]);let l=this;return e.forEach(function(r){var s=a[a.length-1],o=l.distance(r,s);o>n&&a.push(r)}),a}sortPaths(e){return e=e.sort(function(n,a){return n[0][0]-a[0][0]}),e=e.sort(function(n,a){return n[0][1]-a[0][1]}),e}shufflePaths(e){for(let n=e.length-1;n>0;n--){const a=Math.floor(this.getRandom(0,1,this.prng)*(n+1)),l=e[n];e[n]=e[a],e[a]=l}return e}removeShortPaths(e,n=.01){let a=this;return e.filter(function(l){return a.pathLength(l)>=n})}simplify(e,n=1,a=Math.PI/4){var l=[];l.push(e[0],e[1]);let r=Math.atan2(e[1][1]-e[0][1],e[1][0]-e[0][0]);for(let o=1;o<e.length-1;o++){var s=this.distance(l[l.length-1],e[o+1]);let u=Math.atan2(e[o+1][1]-e[o][1],e[o+1][0]-e[o][0]),p=r-u;(Math.abs(p)>a||s>n)&&(r=u,l.push(e[o+1]))}return l}pointsToPaths2(e,n){const a=[];let l=[];for(;e.length>1;){l.length===0&&l.push(e.shift());let r,s=[];for(let p=0;p<e.length;p++){let m=l.length-1;r=this.distance(l[m],e[p]),r<n&&s.push({point:p,distance:r})}if(s.length===0){a.push(l),l=[];continue}s.sort((p,m)=>p.distance>m.distance||p.distance===m.distance&&p.point>m.point?1:-1);let o=s[0].point,u=e[o];l.push(u),e.splice(o,1)}return l.length>0&&a.push(l),a}pointsToPaths(e,n,a=0,l=.001){if(n.length===0)return e;let r,s=[];for(let o=0;o<n.length;o++){let u=e[a].length-1;r=this.distance(e[a][u],n[o]),r<l&&s.push({point:o,distance:r})}if(s.length>0){s.sort((p,m)=>p.distance>m.distance||p.distance===m.distance&&p.point>m.point?1:-1);let o=s[0].point,u=n[o];e[a].push(u),n.splice(o,1)}else e.push([n.shift()]),a++;return e=this.pointsToPaths(e,n,a,l),e}cropToShape(e,n,a=1e-4){let l=[],r=[],s=C(this,c,F).call(this,n);for(let o=0;o<e.length;o++){r=[];for(let u=0;u<e[o].length-1;u++){let p=this.pointInPolygon(s,e[o][u][0],e[o][u][1],a),m=null;u+1<e[o].length&&(m=this.pointInPolygon(s,e[o][u+1][0],e[o][u+1][1],a));let _=!1;if(u===e[o].length-2&&(_=!0),p)if(m)r.push(e[o][u]),_&&r.push(e[o][u+1]);else for(let b=0;b<n.length;b++){let S=this.getLineLineCollision({x:e[o][u][0],y:e[o][u][1]},{x:e[o][u+1][0],y:e[o][u+1][1]},{x:n[b][0],y:n[b][1]},{x:n[(b+1)%n.length][0],y:n[(b+1)%n.length][1]});if(this.pointOnLineSegment(e[o][u],[n[b],n[(b+1)%n.length]],.011)&&S==!1&&(S={x:e[o][u][0],y:e[o][u][1]}),S!==!1){r.push(e[o][u],[S.x,S.y]),r.length>=2&&l.push(r),r=[];break}}else if(m)for(let b=0;b<n.length;b++){let S=this.getLineLineCollision({x:e[o][u][0],y:e[o][u][1]},{x:e[o][u+1][0],y:e[o][u+1][1]},{x:n[b][0],y:n[b][1]},{x:n[(b+1)%n.length][0],y:n[(b+1)%n.length][1]});if(this.pointOnLineSegment(e[o][u],[n[b],n[(b+1)%n.length]],Math.abs(a))&&(S={x:e[o][u][0],y:e[o][u][1]}),S!==!1){r.push([S.x,S.y],e[o][u+1]);break}}else{let b=[];for(let S=0;S<n.length;S++){let w=this.getLineLineCollision({x:e[o][u][0],y:e[o][u][1]},{x:e[o][u+1][0],y:e[o][u+1][1]},{x:n[S][0],y:n[S][1]},{x:n[(S+1)%n.length][0],y:n[(S+1)%n.length][1]});w!==!1&&b.push(w)}if(b.length>0){b.sort((w,P)=>w.x>P.x?1:-1);let S=Math.floor(b.length/2);for(let w=0;w<S;w++)l.push([[b[w*2].x,b[w*2].y],[b[w*2+1].x,b[w*2+1].y]])}}}r.length>=2&&l.push(r)}return l}cropToCircle(e,n=[0,0],a=1){let l=[],r=[];for(let s=0;s<e.length;s++)for(let o=0;o<e[s].length;o++){let u=this.distance([0,0],e[s][o]),p=null;if(o+1<e[s].length&&(p=this.distance([0,0],e[s][o+1])),u<a)if(p!==null&&p>a){let m=this.lineCircleIntersect(e[s][o],e[s][o+1],[[0,0],a]);m.length==1&&r.push(m[0]),l.push(r),r=[]}else r.push(e[s][o]),p===null&&(l.push(r),r=[]);else if(u>a&&p!==null&&p<a){let m=this.lineCircleIntersect(e[s][o],e[s][o+1],[[0,0],a]);m.length==1&&r.push(m[0])}}return r.length>=2&&l.push(r),l}cropToRectangle(e,n,a,l,r){let s=[],o=[],u=[[n,l],[a,l],[a,r],[n,r]];for(let p=0;p<e.length;p++){o=[];for(let m=0;m<e[p].length-1;m++){let _=e[p][m][0]>=n&&e[p][m][0]<=a&&e[p][m][1]>=l&&e[p][m][1]<=r,b=null;m+1<e[p].length&&(b=e[p][m+1][0]>n&&e[p][m+1][0]<a&&e[p][m+1][1]>l&&e[p][m+1][1]<r);let S=!1;if(m===e[p].length-2&&(S=!0),_)if(b)o.push(e[p][m]),S&&o.push(e[p][m+1]);else for(let w=0;w<u.length;w++){let P=this.getLineLineCollision({x:e[p][m][0],y:e[p][m][1]},{x:e[p][m+1][0],y:e[p][m+1][1]},{x:u[w][0],y:u[w][1]},{x:u[(w+1)%u.length][0],y:u[(w+1)%u.length][1]});if(P!==!1){o.push(e[p][m],[P.x,P.y]),o.length>=2&&s.push(o),o=[];break}}else if(b)for(let w=0;w<u.length;w++){let P=this.getLineLineCollision({x:e[p][m][0],y:e[p][m][1]},{x:e[p][m+1][0],y:e[p][m+1][1]},{x:u[w][0],y:u[w][1]},{x:u[(w+1)%u.length][0],y:u[(w+1)%u.length][1]});if(P!==!1){o.push([P.x,P.y],e[p][m+1]);break}}else for(let w=0;w<u.length;w++){let P=this.getLineLineCollision({x:e[p][m][0],y:e[p][m][1]},{x:e[p][m+1][0],y:e[p][m+1][1]},{x:u[w][0],y:u[w][1]},{x:u[(w+1)%u.length][0],y:u[(w+1)%u.length][1]});P!==!1&&o.push([P.x,P.y])}}o.length>=2&&s.push(o)}return s}knockout(e,n){let a=[];for(let l=0;l<e.length;l++){let r=this.shapeIntersections(e[l],n),s=this.booleanSubtractComparison(r,n,!1);a=a.concat(s)}return a}fill(e,n,a=0,l=!0,r=!1,s=null){let o=this.boundingBox(e),u=[o[0][0]+(o[0][1]-o[0][0])/2,o[1][0]+(o[1][1]-o[1][0])/2],p=this.distance([o[0][0],o[1][0]],[o[0][1],o[1][1]]),m=p/n,_=[];for(let S=0;S<m;S++){let w=-p/2+p*(S/m);typeof s=="function"&&(w=s(S/m));let P=[[-p,w],[p,w]];a!==0&&(P=this.rotatePath(P,a)),P=this.translatePath(P,u),_.push(P)}let b=[];for(let S=0;S<_.length;S++){let w=_[S][0],P=_[S][1],q=[];for(let I=0;I<e.length;I++){let L=I+1;L>=e.length&&(L=L%e.length);let T=this.getLineLineCollision({x:w[0],y:w[1]},{x:P[0],y:P[1]},{x:e[I][0],y:e[I][1]},{x:e[L][0],y:e[L][1]});T!==!1&&q.push(T)}if(q.length>0){q.sort((I,L)=>I.x>L.x?1:-1),l&&S%2&&(q=q.reverse());for(let I=0;I<q.length-1;I++)I%2!==1&&(r?b=b.concat([[q[I].x,q[I].y],[q[I+1].x,q[I+1].y]]):b.push([[q[I].x,q[I].y],[q[I+1].x,q[I+1].y]]))}}return r&&(b=[b]),b}layeredPaths(e,n=!1,a=0,l=!1,r=!1){let s=[];for(let o=0;o<e.length;o++){let u=[];if(o==e.length-1){l&&e[o].pop(),s.push(e[o]);break}let p=JSON.parse(JSON.stringify(e));if(p.splice(0,o+1),a>0)for(let m=0;m<p.length;m++)p[m]=this.offsetPath(p[m],a);if(r){const m=this.boundingBox(e[o]);let _=[[m[0][0],m[1][0]],[m[0][1],m[1][0]],[m[0][1],m[1][1]],[m[0][0],m[1][1]]];_.push(_[0]);let b=[];for(const S of p){const w=this.boundingBox(S),P=[[w[0][0],w[1][0]],[w[0][1],w[1][0]],[w[0][1],w[1][1]],[w[0][0],w[1][1]]];P.push(P[0]),this.shapeIntersections(_,P).length!=_.length&&b.push(S)}if(p=b,p.length==0){s.push(e[o]);continue}}for(let m=0;m<e[o].length-1;m++){if(l&&(m==1||m==3&&o>0))continue;let _=[[e[o][m],e[o][m+1]]];_=this.linePathsSplit([e[o][m],e[o][m+1]],p),_.length>0&&(u=u.concat(_))}n&&(u=this.joinPaths(u)),s=s.concat(u)}return s}subtractPaths(e){let n=[];for(let a=0;a<e.length;a++){if(a==e.length-1){n.push({path:e[a]});break}let l=this.deepCopy(e);l.splice(0,a+1);let r=this.deepCopy(e[a]);for(let s=0;s<l.length&&!(typeof r>"u");s++)r=this.booleanSubtract(r,l[s]);r.length>1?n.push({group:r}):n.push({path:r[0]})}return n}linePathSplit(e,n,a=.001){let l=e[0],r=e[1],s=C(this,c,F).call(this,n),o=this.pointInPolygon(s,l[0],l[1]),u=this.pointInPolygon(s,r[0],r[1]);if(o&&u)return[];let p=[];for(let m=0;m<n.length-1;m++){let _=n[m],b=n[m+1],S=this.getLineLineCollision({x:l[0],y:l[1]},{x:r[0],y:r[1]},{x:_[0],y:_[1]},{x:b[0],y:b[1]});S!=!1&&p.push([S.x,S.y])}if(p.length==0)return[[l,r]];if(p.length==1&&o)return[[p[0],r]];if(p.length==1&&u)return[[l,p[0]]];if(p.length==1){let m=this.distance(l,p[0]),_=this.distance(p[0],r);return m>_?[[l,p[0]]]:[[p[0],r]]}else if(p.length==2){let m=this.distance(l,p[0]),_=this.distance(l,p[1]);return m<a&&_<a?[[l,r]]:m<_?[[l,p[0]],[p[1],r]]:[[l,p[1]],[p[0],r]]}return[]}linePathsSplit(e,n){let a=[];for(let l=0;l<n.length;l++){try{a=this.linePathSplit(e,n[l])}catch(s){return console.log(s),a}let r=[];if(typeof a>"u"){console.log("segments is undefined");continue}if(a.length>1){for(let s=0;s<a.length;s++)r=r.concat(this.linePathsSplit(a[s],n));return r}else if(a.length==1)e=a[0];else return a}return a}projectShapeShadow(e,n){let a=[],l=[],r=C(this,c,F).call(this,e),s=!1;t:for(let u=0;u<e.length-0;u++){let p=[e[u],[e[u][0]+n[0],e[u][1]+n[1]]];if(this.pointInPolygon(r,p[1][0],p[1][1],-1e-8)){s||typeof e[u-1]<"u"&&l.push(e[u-1]),l.push(e[u]),s=!0;continue}let m=this.deepCopy(e);m.pop();for(let _=0;_<m.length-2;_++){let b=(u+_+1)%m.length,S=(u+_+2)%m.length,w=[m[b],m[S]];if(this.getLineLineCollision({x:w[0][0],y:w[0][1]},{x:w[1][0],y:w[1][1]},{x:p[0][0],y:p[0][1]},{x:p[1][0],y:p[1][1]})!==!1){s||typeof e[u-1]<"u"&&l.push(e[u-1]),l.push(e[u]),s=!0;continue t}}s&&l.push(e[u]),l.push(p[1]),s=!1,a.push(p)}let o=this.booleanSubtract(l,e)[0];return{perimeter:l,shadow:o,lines:a}}jot(e,n,a,l=0){if(e.length<2)throw"Path must have 2 or more points.";let r=Math.atan2(e[e.length-1][1]-e[e.length-2][1],e[e.length-1][0]-e[e.length-2][0]),s=[[n*Math.cos(r),n*Math.sin(r)],[(n+a)*Math.cos(r),(n+a)*Math.sin(r)]];return l>0&&(s=this.rotatePath(s,this.getRandom(-l,l))),s=this.translatePath(s,e[e.length-1]),s}};c=new WeakSet,D=function(e,n){if(n<=e[0])return-1;for(let a=0;a<e.length-1;a++)if(n>e[a]&&n<=e[a+1])return a;return n>e[e.length-1]?e.length-1:-1},G=function(e,n,a,l){if(e.length!=3||n.length!=3)throw"Points must have 3 dimensions.";let r=[n[0]-e[0],n[1]-e[1],n[2]-e[2]],s=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2)+Math.pow(r[2],2)),o=r.map(function(m){return m/s}),u=[e[0]+a*o[0],e[1]+a*o[1],e[2]+a*o[2]],p=[n[0]+l*o[0],n[1]+l*o[1],n[2]+l*o[2]];return[u,p]},F=function(e){let n=[];for(let a=0;a<e.length-1;a++)n.push({x:e[a][0],y:e[a][1]});return n};let i=f;d.exports&&(d.exports=i,d.exports.default=i)}(PathHelper$1)),PathHelper$1.exports}var PathHelperExports=requirePathHelper();const PathHelper=getDefaultExportFromCjs(PathHelperExports);function createGcode(d,i,c,h="G0"){var v=gCodeHeader(d,i);v=v.concat(gCodeStart()),v=v.concat("; G-code path");for(let g=0;g<c.length;g++)v.push(h+" X"+(c[g][0]+d.table.x.max/2).toFixed(2)+" Y"+(c[g][1]+d.table.y.max/2,2).toFixed(2));return v=v.concat(gCodeFinish()),v}function gCodeHeader(d,i){var c=["; Created using https://markroland.github.io/sand-table-pattern-maker/",";","; "+(new Date().getMonth()+1)+"/"+new Date().getDate()+"/"+new Date().getFullYear()+" "+new Date().getHours()+":"+new Date().getMinutes()+":"+new Date().getSeconds(),";","; Machine Specifications:",";","; Units: "+d.table.units,";","; Min X: "+d.table.x.min,"; Max X: "+d.table.x.max,"; Min Y: "+d.table.y.min,"; Max Y: "+d.table.y.max,"; Motor Speed ("+d.table.units+"/min): "+d.motor.speed,";","; Pattern Specifications:",";","; Name: "+i.name,";","; Parameters:"];const h=Object.entries(i.config);for(const[v,g]of h)c=c.concat([`; - ${v}: ${g}`]);return c=c.concat([";","; URL: "+window.location,";",""]),c}function gCodeStart(){return["","; Custom G-code to execute before the start of the sketch",""]}function gCodeFinish(){return["","; Custom G-code to execute after the end of the sketch",""]}class thetaRho{constructor(i){this.env=i,this.header=["# Created using https://markroland.github.io/sand-table-pattern-maker/","# Version "+i.app.version,"#","# Track Created: "+(new Date().getMonth()+1)+"/"+new Date().getDate()+"/"+new Date().getFullYear()+" "+new Date().getHours()+":"+new Date().getMinutes()+":"+new Date().getSeconds(),"#","# Written by Mark Roland",""],this.preamble=["#","# Custom Theta-Rho to execute before the start of the track","#"],this.postamble=["#","# Custom Theta-Rho to execute after the end of the sketch","#"]}convert(i){const c=this.env.table.x.min,h=this.env.table.x.max,v=this.env.table.y.min,g=this.env.table.y.max;var f,M,e,n,a;new Array,i=this.ThrRotatePath(i,Math.PI/2),i=this.ThrScalePath(i,[-1,1]);var l=Math.min(h-c,g-v)/2,r=this.header;r=r.concat(this.preamble),r=r.concat(""),r=r.concat("# Track"),i=this.subdividePath(i,.125*this.env.ball.diameter),e=this.calcTheta(i[0][0],i[0][1]),r.push(e.toFixed(4)+" "+this.calcRho(i[0][0],i[0][1],l).toFixed(4));for(let s=1;s<i.length;s++)M=this.calcTheta(i[s][0],i[s][1]),M+=Math.floor(e/(2*Math.PI))*(2*Math.PI),n=M-e,n<-Math.PI?n+=2*Math.PI:n>Math.PI&&(n-=2*Math.PI),f=e+n,e=f,a=this.calcRho(i[s][0],i[s][1],l),r.push(f.toFixed(4)+" "+a.toFixed(4));return r=r.concat(""),r=r.concat(this.postamble),r}ThrScalePath(i,c){return i.map(function(h){return[h[0]*c[0],h[1]*c[1]]})}ThrRotatePath(i,c){return i.map(function(h){return[h[0]*Math.cos(c)-h[1]*Math.sin(c),h[0]*Math.sin(c)+h[1]*Math.cos(c)]})}subdividePath(i,c){let h=new Array,v,g,f=i.length-1;for(let e=0;e<f;e++){v=i[e+1][0]-i[e][0],g=i[e+1][1]-i[e][1];let n=Math.sqrt(Math.pow(v,2)+Math.pow(g,2)),a=Math.ceil(n/c);for(var M=0;M<a;M++)h.push([i[e][0]+v*(M/a),i[e][1]+g*(M/a)]);e+1==f&&h.push([i[e][0]+v,i[e][1]+g])}return h.concat(i.slice(-1)),h}calcTheta(i,c){let h=Math.atan2(c,i);return h<0&&(h=2*Math.PI+h),h}calcRho(i,c,h){return Math.sqrt(Math.pow(i,2)+Math.pow(c,2))/h}}class Coordinates{constructor(){this.key="coordinates",this.name="XY Coordinates",this.config={coordinates:{name:"Coordinates",value:null,input:{type:"createTextarea",attributes:{rows:11,cols:12},value:`100,0
0,100
-100,0
0,-100
100,0`,params:[]}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.coordinates.value=document.querySelector("#pattern-controls > div:nth-child(1) > textarea").value;let i=this.calc(this.config.coordinates.value);return this.path=i,i}calc(i){let c,h,v=new Array;return i.split(`
`).forEach(function(f){let M=f.split(",");c=parseFloat(M[0]),h=parseFloat(M[1]),v.push([c,h])}),v}}class Circle{constructor(i){this.key="circle",this.name="Circle";const c=Math.min(i.table.x.max-i.table.x.min,i.table.y.max-i.table.y.min)/2;this.config={radius:{name:"Radius (r)",value:null,input:{type:"createSlider",params:[1,.5*Math.min(i.table.x.max,i.table.y.max),c/2,1],class:"slider",displayValue:!0}},angle:{name:"Start Angle (𝜃)",value:null,input:{type:"createSlider",params:[0,360,0,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.radius.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.angle.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.radius.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.angle.value+"°";let i=this.calc(0,0,this.config.radius.value,this.config.angle.value/360*(2*Math.PI));return this.path=i,i}calc(i,c,h,v,g=1){var f,M,e=v,n=new Array,a=0;let l=60;for(;e<v+2*Math.PI;)e=g*(v+a/l*(2*Math.PI)),f=i+h*Math.cos(e),M=c+h*Math.sin(e),n.push([f,M]),a++;return n}}class Cross{constructor(i){this.key="cross",this.name="Cross",this.env=i,this.config={width:{name:"Width",value:null,input:{type:"createSlider",params:[1,i.table.x.max-i.table.x.min,.3*(i.table.x.max-i.table.x.min),1],class:"slider",displayValue:!0}},height:{name:"Height",value:null,input:{type:"createSlider",params:[1,i.table.x.max-i.table.x.min,(i.table.x.max-i.table.x.min)/2,1],class:"slider",displayValue:!0}},intersect:{name:"Intersect Height",value:null,input:{type:"createSlider",params:[0,100,75,1],class:"slider",displayValue:!0}},starburst:{name:"Starburst",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:!0}],params:[0,1,1],displayValue:!1}}},this.path=[]}draw(){this.config.width.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.height.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.intersect.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.starburst.value=!1,document.querySelector("#pattern-controls > div:nth-child(4) > input[type=checkbox]").checked&&(this.config.starburst.value=!0),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.width.value+" "+this.env.table.units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.height.value+" "+this.env.table.units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.intersect.value+"%";let i=this.calc(this.config.width.value,this.config.height.value,this.config.intersect.value/100,this.config.starburst.value);return this.path=i,i}calc(i,c,h,v){var g=new Array;let f=h*c-c/2;this.env.table.x.min,this.env.table.x.max,this.env.table.y.min,this.env.table.y.max;let M=this.env.ball.diameter/2,e=3;var n;if(v){g.push([0,f]);let s,o;for(var a=0;a<16;a++)s=i/2+(e+3)*M,o=c/2+(e+3)*M-f,a/16>.5&&(o=c/2+(e+3)*M+f),(a+2)%4==0&&(s=.9*s,o=.9*o),(a+1)%2==0&&(s=.8*s,o=.8*o),g.push([s*Math.cos(a/16*(2*Math.PI)),o*Math.sin(a/16*(2*Math.PI))+f]),g.push([0,f])}for(var l=new Array,a=0;a<e;a++)n=a*M,l=l.concat([[0-n,f-n],[-i/2-n,f-n],[-i/2-n,f+n],[0-n,f+n],[0-n,c/2+n],[0+n,c/2+n],[0+n,f+n],[i/2+n,f+n],[i/2+n,f-n],[0+n,f-n],[0+n,-c/2-n],[0-n,-c/2-n],[0-n,f-n]]);for(var r=new Array,a=0;a<l.length;a++)r.push(l[l.length-1-a]);return g=g.concat(r),g}}var k,N;class Cycloid{constructor(i){H(this,k);this.key="cycloid",this.name="Cycloid",this.config={radius_a:{name:"Fixed Radius (A)",value:null,input:{type:"createSlider",params:[1,Math.floor(.5*Math.min((i.table.x.max,i.table.y.max))),30,1],class:"slider",displayValue:!0}},radius_b:{name:"Fixed Radius (B)",value:null,input:{type:"createSlider",params:[-Math.floor(.5*Math.min(i.table.x.max,i.table.y.max)),-1,-Math.floor(.25*Math.min(i.table.x.max,i.table.y.max)),1],class:"slider",displayValue:!0}},arm_length:{name:"Arm Length",value:null,input:{type:"createSlider",params:[1,.5*Math.min(i.table.x.max,i.table.y.max),Math.floor(.25*Math.min(i.table.x.max,i.table.y.max)),1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.radius_a.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.radius_b.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.arm_length.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.radius_a.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.radius_b.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.arm_length.value;let i=this.calc(this.config.radius_a.value,this.config.radius_b.value,this.config.arm_length.value);return this.path=i,i}calc(i,c,h){for(var v,g,f=0,M=new Array,e=0,n=10,a=Math.abs(c/this.greatest_common_divisor(parseInt(i),parseInt(c)))*(2*Math.PI);f<a;)f=C(this,k,N).call(this,n*e),v=(i+c)*Math.cos(f)+h*Math.cos((i+c)/c*f),g=(i+c)*Math.sin(f)+h*Math.sin((i+c)/c*f),M.push([v,g]),e++;return M}greatest_common_divisor(i,c){return c==0?i:this.greatest_common_divisor(c,i%c)}}k=new WeakSet,N=function(i){return i*(Math.PI/180)};class Diameters{constructor(i){this.key="diameters",this.name="Diameters",this.env=i,this.config={spokes:{name:"Spokes",value:null,input:{type:"createSlider",params:[2,60,12,2],class:"slider",displayValue:!0}},waves:{name:"Waves",value:null,input:{type:"createSlider",params:[1,30,4,1],class:"slider",displayValue:!0}},amplitude:{name:"Amplitude",value:null,input:{type:"createSlider",params:[0,60,20,1],class:"slider",displayValue:!0}}},this.path=[]}draw(){this.config.spokes.value=document.querySelector("#pattern-controls > div:nth-child(1) > input").value,this.config.waves.value=document.querySelector("#pattern-controls > div:nth-child(2) > input").value,this.config.amplitude.value=document.querySelector("#pattern-controls > div:nth-child(3) > input").value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.spokes.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.waves.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.amplitude.value;let i=this.calc(parseInt(this.config.spokes.value),parseInt(this.config.waves.value),parseInt(this.config.amplitude.value));return this.path=i,i}calc(i,c,h){var v,g,f=0;const M=this.env.table.x.max,e=this.env.table.y.max;for(var n=new Array,a=0,l=2*Math.PI/i,r=20*c,s=1;f<2*Math.PI;){f=a*l;for(var o=0;o<=r;o++)v=s*(Math.min(M,e)/2)*((o-r/2)/(r/2)),g=h*Math.sin(o/r*c*(2*Math.PI)),n.push(this.rotationMatrix(v,g,f));a++,s=s*-1}return n}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}}class Draw{constructor(i){this.key="draw",this.name="Free Draw",this.env=i,this.config={},this.path=[[0,0]]}draw(){const i=this.env.table.x.min,c=this.env.table.x.max,h=this.env.table.y.min,v=this.env.table.y.max,g=this.env.mouse.x,f=this.env.mouse.y;let M,e,n,a,l=[];return this.env.mouse.pressed&&(M=g-this.env.canvas.width/2,e=-(f-this.env.canvas.height/2),n=M+(c-i)/2,a=e+(v-h)/2,n>i&&n<c&&a>h&&a<v&&(l.length==1&&l[0][0]==0&&l[0][1]==0?this.path=[[M,e]]:this.path.push([M,e]))),this.path}}class Egg{constructor(i){this.key="egg",this.name="Easter Eggs";let c=Math.min(i.table.x.max-i.table.x.min,i.table.y.max-i.table.y.min)/2;this.config={radius:{name:"Size",value:null,input:{type:"createSlider",params:[80,.5*Math.min(i.table.x.max,i.table.y.max),c/2,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.radius.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.radius.value;let i=this.calc(this.config.radius.value);return this.path=i,i}calc(i,c=1){var h;let v=new Array,g,f;var M=new Array,e=new Array;let n=60;for(var a=0;a<=n;a++)h=a/n*(2*Math.PI)-Math.PI,e=this.parametricEgg(h),v.push([i*e[0],i*e[1]]);let l=this.getPathCenter(v);v=this.translatePath(v,[-l[0],-l[1]]),v=this.rotatePath(v,-.5*Math.PI);let r=this.spiralizePath(v,10,60);return g=v.concat(r.reverse()),g=this.rotatePath(g,Math.PI/10),g=this.translatePath(g,[-30,0]),f=this.stripePath(v).reverse(),f=f.concat(v),f=this.scalePath(f,.8),f=this.translatePath(f,[30,0]),f=this.rotatePath(f,-Math.PI/8),M=g.concat(f),M}parametricEgg(i){let c,h,v=1,g=2.02;return c=1/(2*Math.sqrt(1+Math.pow(v,2)))*((Math.pow(v,2)-1)/v*g+(Math.pow(v,2)+1)/v*g*Math.sqrt(Math.pow(g,2)-4*v*Math.cos(i))),h=2*Math.sin(i)/(g+Math.sqrt(Math.pow(g,2)-4*v*Math.cos(i))),c=.4*c,[c,h]}arrayColumn(i,c){return i.map(h=>h[c])}getPathCenter(i){let c=this.arrayColumn(i,0),h=this.arrayColumn(i,1),v=Math.min(...c),g=Math.min(...h);return[v+(Math.max(...c)-v)/2,g+(Math.max(...h)-g)/2]}stripePath(i){let c=new Array,h;for(var v=0;v<i.length;v++)v%4==0||v%4==1?h=v:(v%4==2||v%4==3)&&(h=i.length-v),c.push(i[h]);return c}spiralizePath(i,c){let h=new Array,v=new Array,g=i.length*c,f=[0,-50];for(var M=0;M<g;M++)h=[i[M%i.length][0],i[M%i.length][1]],v.push([-(h[0]*(M/g)+-0*M/g)+f[0],h[1]*(M/g)+50*M/g+f[1]]);return v}scalePath(i,c){return i.map(function(h){return[h[0]*c,h[1]*c]})}translatePath(i,c){return i.map(function(h){return[h[0]+c[0],h[1]+c[1]]})}rotatePath(i,c){return i.map(function(h){return[h[0]*Math.cos(c)-h[1]*Math.sin(c),h[0]*Math.sin(c)+h[1]*Math.cos(c)]})}}class Farris{constructor(i){this.key="farris",this.name="Farris Curve",this.env=i,this.path_sampling_optimization=2,this.config={A:{name:"A Coefficient",value:null,input:{type:"createSlider",params:[0,20,1,1],class:"slider",displayValue:!0}},B:{name:"B Coefficient",value:null,input:{type:"createSlider",params:[0,20,6,1],class:"slider",displayValue:!0}},C:{name:"C Coefficient",value:null,input:{type:"createSlider",params:[0,20,14,1],class:"slider",displayValue:!0}},scale:{name:"Scale",value:null,input:{type:"createSlider",params:[0,100,25,1],class:"slider",displayValue:!0}},rotation:{name:"Rotation",value:null,input:{type:"createSlider",params:[-180,180,0,1],class:"slider",displayValue:!0}}},this.path=[]}draw(){const i=this.env.table.x.min,c=this.env.table.x.max,h=this.env.table.y.min,v=this.env.table.y.max;this.config.A.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.B.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.C.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.scale.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.rotation.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.A.value.toFixed(0),document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.B.value.toFixed(0),document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.C.value.toFixed(0),document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.scale.value.toFixed(0)+"%",document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=this.config.rotation.value.toFixed(0)+"°";let g=this.calc(Math.min(c-i,v-h),this.config.A.value,this.config.B.value,this.config.C.value,this.config.scale.value,this.config.rotation.value);return this.path=g,g}calc(i,c,h,v,g,f){var M,e,n=0,a=new Array,l=0;let r=2*Math.PI,s=1e3;for(;n<r;)n=l/s*r,M=g/100*i*(Math.cos(c*n)+Math.cos(h*n)/2+Math.sin(v*n)/3),e=g/100*i*(Math.sin(c*n)+Math.sin(h*n)/2+Math.cos(v*n)/3),a.push([M,e]),l++;return f=f-Math.atan2(1/3,1.5)*180/Math.PI,a=a.map(function(o){return this.rotationMatrix(o[0],o[1],f*(Math.PI/180))},this),a}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}}class FermatSpiral{constructor(){this.key="fermatspiral",this.name="Fermat's Spiral",this.config={revolutions:{name:"Revolutions",value:null,input:{type:"createSlider",params:[1,10,3,1],class:"slider",displayValue:!0}},return:{name:"Return Home",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.revolutions.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.revolutions.value,this.config.return.value=!1,document.querySelector("#pattern-controls > div:nth-child(2) > input[type=checkbox]").checked&&(this.config.return.value=!0);let i=this.calc(this.config.revolutions.value,this.config.return.value);return this.path=i,i}calc(i,c){var h,v,g=new Array;const f=1;let M=30/i;const e=60,n=i*0,a=i*(2*Math.PI),l=(a-n)/(i*e);for(var r=a;r>=n;r-=l)h=M*Math.pow(r,f)*Math.cos(r),v=M*Math.pow(r,f)*Math.sin(r),g.push([h,v]);for(var r=n;r<=a+l;r+=l)h=-M*Math.pow(r,f)*Math.cos(r),v=-M*Math.pow(r,f)*Math.sin(r),g.push([h,v]);if(c){var s=24;let u=Math.min(max_x-min_x,max_y-min_y)/2;for(var o=1;o<=s;o++)g.push([u*Math.cos(o/s*Math.PI+Math.PI),u*Math.sin(o/s*Math.PI+Math.PI)]);g.push([u,0])}return g}}class Fibonacci{constructor(i){this.key="fibonacci",this.name="Fibonacci",this.env=i,this.config={decay:{name:"Decay Factor",value:null,input:{type:"createSlider",params:[-.02,-.001,-.004,1e-4],class:"slider",displayValue:!0}},rtc:{name:"Return to Center",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.decay.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.rtc.value=!1,document.querySelector("#pattern-controls > div:nth-child(2) > input[type=checkbox]").checked&&(this.config.rtc.value=!0),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.decay.value.toFixed(4);let i=this.calc(this.config.decay.value,this.config.rtc.value);return this.path=i,i}calc(i,c){const h=this.env.table.x.min,v=this.env.table.x.max,g=this.env.table.y.min,f=this.env.table.y.max,M=this.env.ball.diameter;for(var e=new Array,n=Math.min(v-h,f-g)/2,a,l,r,s,o=M/2,u=Math.log(o/n)/i,p=0;p<u;p++)l=p*Math.PI*(3-Math.sqrt(5)),a=n*Math.exp(i*p),r=a*Math.cos(l),s=a*Math.sin(l),e.push([r,s]),c&&e.push([0,0]);return c||e.push([0,0]),e}}class FibonacciLollipops{constructor(i){this.key="fibonaccilollipops",this.name="Fibonacci Lollipops",this.env=i,this.config={lollipopradius:{name:"Lollipop Radius",value:null,input:{type:"createSlider",params:[10,60,30,1],class:"slider",displayValue:!0}},lollipopsides:{name:"Lollipop Sides",value:null,input:{type:"createSlider",params:[3,12,6,1],class:"slider",displayValue:!0}},lollipopturns:{name:"Lollipop Turns",value:null,input:{type:"createSlider",params:[1.5,7.5,3.5,1],class:"slider",displayValue:!0}},spiral_factor:{name:"Shrink Factor",value:null,input:{type:"createSlider",params:[-.02,-.003,-.01,1e-4],class:"slider",displayValue:!0}}},this.path=[]}draw(){this.config.lollipopradius.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.lollipopsides.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.lollipopturns.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.spiral_factor.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.lollipopradius.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.lollipopsides.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.lollipopturns.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.spiral_factor.value.toFixed(4);let i=this.calc(this.config.lollipopradius.value,this.config.lollipopsides.value,this.config.lollipopturns.value,this.config.spiral_factor.value);return this.path=i,i}calc(i,c,h,v){const g=this.env.table.x.min,f=this.env.table.x.max,M=this.env.table.y.min,e=this.env.table.y.max,n=this.env.ball.diameter;for(var a=new Array,l=Math.min(f-g,e-M)/2,r,s,o=n/2,u=Math.log(o/l)/v,p=new Array,m,_,b,S,w=0;w<u;w++){s=w*Math.PI*(3-Math.sqrt(5)),r=(l-i)*Math.exp(v*w),p=[];for(var P=0;P<=h*c;P++)S=P/c*(2*Math.PI),b=i*(1-.5*(w/u))*(P/(h*c)),m=b*Math.cos(S),_=b*Math.sin(S),p.push([m,_]);p=this.translate_path(p,r,0),a=a.concat(this.rotationMatrix(p,s)),a.push([0,0])}return a}translate_path(i,c,h){return i.map(function(v){return[v[0]+c,v[1]+h]})}rotationMatrix(i,c){return i.map(function(h){return[h[0]*Math.cos(c)-h[1]*Math.sin(c),h[0]*Math.sin(c)+h[1]*Math.cos(c)]})}}class Frame{constructor(i){this.key="frame",this.name="Frames (Border Patterns)",this.env=i,this.config={num_spiral:{name:"Spirals",value:null,input:{type:"createSlider",params:[2,12,4,1],class:"slider",displayValue:!0}},a:{name:"a",value:null,input:{type:"createSlider",params:[-1,1,.5,.01],class:"slider",displayValue:!0}},b:{name:"b",value:null,input:{type:"createSlider",params:[-1,0,-.35,.01],class:"slider",displayValue:!0}},revolutions:{name:"Revolutions",value:null,input:{type:"createSlider",params:[.1,4,2,.1],class:"slider",displayValue:!0}},rotate:{name:"Rotate",value:null,input:{type:"createSlider",params:[0,360,0,1],class:"slider",displayValue:!0}}},this.path=[]}draw(){this.config.num_spiral.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.a.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.b.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.revolutions.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.rotate.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.num_spiral.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.a.value.toFixed(2)+" * r<sub>max</sub>",document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.b.value.toFixed(2),document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.revolutions.value.toFixed(1),document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=this.config.rotate.value+"°";let i=this.calc(this.config.num_spiral.value,this.config.a.value,this.config.b.value,this.config.revolutions.value,60);return this.config.rotate.value>0&&(i=this.rotationMatrix(i,this.config.rotate.value*(Math.PI/180))),this.path=i,i}calc(i,c,h,v,n){const f=this.env.table.x.max,M=this.env.table.y.max;let e=Math.min(f/2,M/2);var n=60;let a=this.LogSpiral(c,h,v,n);var l=-a[0][0];a=this.translate_path(a,l,0),a=this.rotationMatrix(a,-.1*Math.PI),a=this.translate_path(a,e,0);for(var r=new Array,s=0;s<=n;s++)r.push([e*Math.cos(s/n*2*Math.PI),-e*Math.sin(s/n*2*Math.PI)]),s%(n/i)<1&&(r=r.concat(this.rotationMatrix(a,-(s/n)*2*Math.PI)));return r}translate_path(i,c,h){return i.map(function(v){return[v[0]+c,v[1]+h]})}rotationMatrix(i,c){return i.map(function(h){return[h[0]*Math.cos(c)-h[1]*Math.sin(c),h[0]*Math.sin(c)+h[1]*Math.cos(c)]})}LogSpiral(i,c,h,v){const g=this.env.table.x.min,f=this.env.table.x.max,M=this.env.table.y.min,e=this.env.table.y.max;var n,a,l=0,r=Math.min(f-g,e-M)/2,s=new Array;let o=(h+1/v)*(2*Math.PI),u=2*Math.PI/v;for(var l=0;l<o;l+=u)n=r*i*Math.exp(c*l)*Math.cos(l),a=r*i*Math.exp(c*l)*Math.sin(l),s.push([n,a]);for(var p=new Array,m=0;m<s.length;m++)p.push(s[s.length-1-m]);return s=s.concat(p),s}}class Gcode{constructor(i){this.key="gcode",this.name="G-Code",this.env=i,this.config={gcode:{name:"G-Code",value:null,input:{type:"createTextarea",attributes:{rows:11,cols:22},value:`G0 X336.00 Y190.00
G0 X236.00 Y290.00
G0 X136.00 Y190.00
G0 X236.00 Y90.00
G0 X336.00 Y190.00`,params:[]}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.gcode.value=document.querySelector("#pattern-controls > div:nth-child(1) > textarea").value;let i=this.calc(this.config.gcode.value);return this.path=i,i}calc(i){const c=this.env.table.x.min,h=this.env.table.x.max,v=this.env.table.y.min,g=this.env.table.y.max;let f,M,e=new Array;return i.split(`
`).forEach(function(a){let l=a.match(/^G[0,1]\s[X,Y]([0-9\.]+)\s?[X,Y]([0-9\.]+)/);l&&(f=parseFloat(l[1]),M=parseFloat(l[2]),f-=(h-c)/2,M-=(g-v)/2,e.push([f,M]))}),e}}class Gravity{constructor(i){this.key="gravity",this.name="Gravity",this.env=i,this.config={steps:{name:"Iteration Steps",value:null,input:{type:"createSlider",params:[1e3,1e4,2e3,100],class:"slider",displayValue:!0}},A1m:{name:"Attractor Mass",value:null,input:{type:"createSlider",params:[.1,100,50,1e-4],class:"slider",displayValue:!0}},xp0:{name:"X0 Position",value:null,input:{type:"createSlider",params:[-(i.table.x.max-i.table.x.min)/2,(i.table.x.max-i.table.x.min)/2,0,1],class:"slider",displayValue:!0}},yp0:{name:"Y0 Position",value:null,input:{type:"createSlider",params:[-(i.table.y.max-i.table.y.min)/2,(i.table.y.max-i.table.y.min)/2,0,.1],class:"slider",displayValue:!0}},xv0:{name:"X0 Velocity",value:null,input:{type:"createSlider",params:[-20,20,5,.01],class:"slider",displayValue:!0}},yv0:{name:"Y0 Velocity",value:null,input:{type:"createSlider",params:[-20,20,5,.01],class:"slider",displayValue:!0}}},this.path=[],this.movers,this.attractors=[]}draw(){return this.config.steps.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.A1m.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.xp0.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.yp0.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.xv0.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),this.config.yv0.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(6) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.steps.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.A1m.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.xp0.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.yp0.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=this.config.xv0.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(6) > span").innerHTML=this.config.yv0.value,this.mover=new Mover(10,this.config.xp0.value,this.config.yp0.value,this.config.xv0.value,this.config.yv0.value),this.attractors[0]=new Attractor(1,this.config.A1m.value,-100,0),this.attractors[1]=new Attractor(1,this.config.A1m.value,100,0),this.calc(this.config.steps.value)}calc(i){let c=new Array,h=new Array,v=new p5.Vector(0,0),g,f;for(var M=0;M<i;M++)g=this.attractors[0].calculateAttraction(this.mover,5,20),f=this.attractors[1].calculateAttraction(this.mover,5,20),v=p5.Vector.add(g,f),this.mover.applyForce(v),this.mover.update(),h=[this.mover.position.x,this.mover.position.y],h[0]>-(this.env.table.x.max-this.env.table.x.min)/2&&h[0]<(this.env.table.x.max-this.env.table.x.min)/2&&h[1]>-(this.env.table.y.max-this.env.table.y.min)/2&&h[1]<(this.env.table.y.max-this.env.table.y.min)/2&&c.push(h);return c}}var E,j;class Attractor{constructor(i,c,h,v){H(this,E);this.position=new p5.Vector(h,v),this.mass=c,this.G=i}calculateAttraction(i,c=5,h=20){let v=p5.Vector.sub(this.position,i.position),g=v.mag();g=C(this,E,j).call(this,g,c,h),v.normalize();let f=this.G*this.mass*i.mass/(g*g);return v.mult(f),v}}E=new WeakSet,j=function(i,c,h){return i<c?c:i>h?h:i};class Mover{constructor(i,c,h,v,g){this.mass=i,this.position=new p5.Vector(c,h),this.velocity=new p5.Vector(v,g),this.acceleration=new p5.Vector(0,0)}applyForce(i){let c=p5.Vector.div(i,this.mass);this.acceleration.add(c)}update(){this.velocity.add(this.acceleration),this.position.add(this.velocity),this.acceleration.mult(0)}}class Heart{constructor(){this.key="heart",this.name="Heart",this.config={a:{name:"X cof. a",value:null,input:{type:"createSlider",params:[1,20,16,1],class:"slider",displayValue:!0}},b:{name:"Y cof. b",value:null,input:{type:"createSlider",params:[1,20,13,1],class:"slider",displayValue:!0}},c:{name:"Y cof. c",value:null,input:{type:"createSlider",params:[1,20,5,1],class:"slider",displayValue:!0}},d:{name:"Y cof. d",value:null,input:{type:"createSlider",params:[1,20,2,1],class:"slider",displayValue:!0}},e:{name:"Y cof. e",value:null,input:{type:"createSlider",params:[1,20,1,1],class:"slider",displayValue:!0}},scale:{name:"scale",value:null,input:{type:"createSlider",params:[1,20,10,.2],class:"slider",displayValue:!0}},shrink:{name:"shrink",value:null,input:{type:"createSlider",params:[2e-4,.002,3e-4,1e-4],class:"slider",displayValue:!0}},twist:{name:"Twist",value:null,input:{type:"createSlider",params:[-1,1,0,.01],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.a.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.b.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.c.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.d.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.e.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),this.config.scale.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(6) > input").value),this.config.shrink.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(7) > input").value),this.config.twist.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(8) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.a.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.b.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.c.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.d.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=this.config.e.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(6) > span").innerHTML=this.config.scale.value.toFixed(1),document.querySelector("#pattern-controls > div.pattern-control:nth-child(7) > span").innerHTML=this.config.shrink.value.toFixed(4),document.querySelector("#pattern-controls > div.pattern-control:nth-child(8) > span").innerHTML=this.config.twist.value.toFixed(2);let i=this.calc(this.config.a.value,this.config.b.value,this.config.c.value,this.config.d.value,this.config.e.value,this.config.scale.value,this.config.shrink.value,this.config.twist.value);return this.path=i,i}calc(i,c,h,v,g,f,M,e){var n,a,l=1,r=0,s=new Array,o=0;let u=80;for(;l>0;)r=o/u*(2*Math.PI),n=l*f*(i*Math.pow(Math.sin(r),3)),a=l*f*(c*Math.cos(r)-h*Math.cos(2*r)-v*Math.cos(3*r)-g*Math.cos(4*r)),s.push(this.rotationMatrix(n,a,e*r/u)),l-=M,o++;return s}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}}var V,A;class Lindenmayer{constructor(i){H(this,V);this.key="lindenmayer",this.name="Space Filling Curves",this.env=i,this.hilbert_curve={l_system:{axiom:"A",rules:[["A","-BF+AFA+FB-"],["B","+AF-BFB-FA+"]]},draw:{length:i.ball.diameter,angle:90}},this.gosper_curve={l_system:{axiom:"A",rules:[["A","A+BF++BF-FA--FAFA-BF+"],["B","-FA+BFBF++BF+FA--FA-B"]]},draw:{length:i.ball.diameter,angle:60}},this.sierpinski_arrowhead={l_system:{axiom:"AF",rules:[["A","BF+AF+B"],["B","AF-BF-A"]]},draw:{length:i.ball.diameter,angle:60}},this.curve=this.sierpinski_arrowhead,this.config={curve:{name:"Curve",value:null,input:{type:"createSelect",options:{hilbert_curve:"Hilbert Curve",gosper_curve:"Gosper Curve",sierpinski_arrowhead:"Sierpinski Arrowhead"}}},iterations:{name:"Iterations",value:null,input:{type:"createSlider",params:[1,7,3,1],class:"slider",displayValue:!0}},length:{name:"Line Length",value:null,input:{type:"createSlider",params:[1,50,10,.1],class:"slider",displayValue:!0}},rotate:{name:"Rotate",value:null,input:{type:"createSlider",params:[0,360,0,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){var i=document.querySelector("#pattern-controls > div:nth-child(1) > select").value;this.config.curve.value=i,this.curve=this[i],this.config.iterations.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.curve.iterations=parseInt(this.config.iterations.value),this.config.length.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.rotate.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.iterations.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.length.value.toFixed(1)+" "+this.env.table.units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.rotate.value+"°";let c=this.curve.l_system.axiom;for(let v=0;v<this.curve.iterations;v++)c=this.compose_lindenmayer_string(c);let h=this.calc(c,this.config.length.value);return this.path=h,h}calc(i,c){var h=new Array,v=0;let g=0,f=0;for(var M=0;v<i.length-1;){if(i[v]=="F"){let e=g+c*Math.cos(C(this,V,A).call(this,M)),n=f+c*Math.sin(C(this,V,A).call(this,M));h.push([e,n]),g=e,f=n}else i[v]=="+"?M+=this.curve.draw.angle:i[v]=="-"&&(M-=this.curve.draw.angle);v++}return h=this.translate_to_center(h),this.config.rotate.value>0&&(h=this.rotate_around_center(h),h=this.translate_to_center(h)),h}compose_lindenmayer_string(i){let c="";for(let h=0;h<i.length;h++){let v=0;for(let g=0;g<this.curve.l_system.rules.length;g++)if(i[h]==this.curve.l_system.rules[g][0]){c+=this.curve.l_system.rules[g][1],v=1;break}v==0&&(c+=i[h])}return c}translate_to_center(i){const c=(n,a)=>n.map(l=>l[a]);var h=c(i,0),v=Math.min(...h),g=Math.max(...h),f=c(i,1),M=Math.min(...f),e=Math.max(...f);return i.map(function(n){return[n[0]-v-(g-v)/2,n[1]-M-(e-M)/2]})}rotate_around_center(i){var c=C(this,V,A).call(this,this.config.rotate.value);return i.map(function(h){var v=h[0],g=h[1];return[v*Math.cos(c)-g*Math.sin(c),v*Math.sin(c)+g*Math.cos(c)]})}}V=new WeakSet,A=function(i){return i*(Math.PI/180)};class Lissajous{constructor(i){this.key="lissajous",this.name="Lissajous Curve",this.path_sampling_optimization=2,Math.min(i.table.x.max-i.table.x.min,i.table.y.max-i.table.y.min)/2,this.config={A:{name:"X Amplitude",value:null,input:{type:"createSlider",params:[0,(i.table.x.max-i.table.x.min)/2,(i.table.x.max-i.table.x.min)/2,1],class:"slider",displayValue:!0}},a1:{name:"X Frequency (a)",value:null,input:{type:"createSlider",params:[1,100,8,1],class:"slider",displayValue:!0}},B:{name:"Y Amplitude",value:null,input:{type:"createSlider",params:[0,(i.table.y.max-i.table.y.min)/2,(i.table.y.max-i.table.y.min)/2,1],class:"slider",displayValue:!0}},b1:{name:"Y Frequency (b)",value:null,input:{type:"createSlider",params:[1,100,9,1],class:"slider",displayValue:!0}},phase:{name:"Phase Offset",value:null,input:{type:"createSlider",params:[-Math.PI,Math.PI,0,Math.PI/32],class:"slider",displayValue:!0}},rotation:{name:"Rotation",value:null,input:{type:"createSlider",params:[-180,180,0,1],class:"slider",displayValue:!0}}},this.path=[]}draw(){this.config.A.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.a1.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.B.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.b1.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.phase.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),this.config.rotation.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(6) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.A.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.a1.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.B.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.b1.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=Math.round(parseFloat(this.config.phase.value)*(180/Math.PI),2)+"°",document.querySelector("#pattern-controls > div.pattern-control:nth-child(6) > span").innerHTML=this.config.rotation.value+"°";let i=this.calc(this.config.A.value,this.config.a1.value,this.config.B.value,this.config.b1.value,this.config.phase.value,this.config.rotation.value);return this.path=i,i}calc(i,c,h,v,g,f){var M,e,n=0,a=new Array,l=0;let r=2*Math.PI/this.greatest_common_divisor(c,v),s=5e3;for(;n<r;)n=l/s*r,M=i*Math.cos(c*n+g),e=h*Math.cos(v*n),a.push([M,e]),l++;return f!=0&&(a=a.map(function(o){return this.rotationMatrix(o[0],o[1],f*(Math.PI/180))},this)),a}greatest_common_divisor(i,c){return c==0?i:this.greatest_common_divisor(c,i%c)}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}}class LogarithmicSpiral{constructor(i){this.key="logspiral",this.name="Spiral (Logarithmic)",this.env=i,this.config={a:{name:"a",value:null,input:{type:"createSlider",params:[-1,1,1,.1],class:"slider",displayValue:!0}},b:{name:"b",value:null,input:{type:"createSlider",params:[-1,0,-.25,.01],class:"slider",displayValue:!0}},revolutions:{name:"Revolutions",value:null,input:{type:"createSlider",params:[1,60,4,1],class:"slider",displayValue:!0}},rotate:{name:"Rotate",value:null,input:{type:"createSlider",params:[0,360,0,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.a.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.b.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.revolutions.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.rotate.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.a.value.toFixed(2)+" * r<sub>max</sub>",document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.b.value.toFixed(2),document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.revolutions.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.rotate.value+"°";let i=this.calc(this.config.a.value,this.config.b.value,this.config.revolutions.value,60);return this.path=i,this.config.rotate.value>0&&(i=this.rotate_around_center(i)),i}calc(i,c,h,v){const g=this.env.table.x.min,f=this.env.table.x.max,M=this.env.table.y.min,e=this.env.table.y.max;var n,a,l=0,r=Math.min(f-g,e-M)/2,s=new Array;let o=(h+1/v)*(2*Math.PI),u=2*Math.PI/v;for(var l=0;l<o;l+=u)n=r*i*Math.exp(c*l)*Math.cos(l),a=r*i*Math.exp(c*l)*Math.sin(l),s.push([n,a]);return s}rotate_around_center(i){var c=this.config.rotate.value*(Math.PI/180);return i.map(function(h){var v=h[0],g=h[1];return[v*Math.cos(c)-g*Math.sin(c),v*Math.sin(c)+g*Math.cos(c)]})}}class Parametric{constructor(){this.key="parametric",this.name="Parametric";let d={x:"40 * Math.sin(t) * (Math.pow(Math.E, Math.cos(t)) - 2 * Math.cos(4*t) - Math.pow(Math.sin(t/12), 5))",y:"40 * Math.cos(t) * (Math.pow(Math.E, Math.cos(t)) - 2 * Math.cos(4*t) - Math.pow(Math.sin(t/12), 5))"};this.config={x:{name:"X",value:null,input:{type:"createInput",params:[d.x]}},y:{name:"Y",value:null,input:{type:"createInput",params:[d.y]}}},this.path=[]}draw(){this.config.x.value=document.querySelector("#pattern-controls > div:nth-child(1) > input").value,this.config.y.value=document.querySelector("#pattern-controls > div:nth-child(2) > input").value;let d=this.calc(this.config.x.value,this.config.y.value);return this.path=d,d}calc(x_equation,y_equation){var x,y,t=0,path=new Array,step=0;let steps_per_revolution=120;for(;t<2*Math.PI;)t=step/steps_per_revolution*(2*Math.PI),x=eval(x_equation),y=eval(y_equation),path.push([x,y]),step++;return path}}class Rectangle{constructor(i){this.key="rectangle",this.name="Rectangle",this.config={width:{name:"Width",value:null,input:{type:"createSlider",params:[1,i.table.x.max-i.table.x.min,(i.table.x.max-i.table.x.min)/2,1],class:"slider",displayValue:!0}},height:{name:"Height",value:null,input:{type:"createSlider",params:[1,i.table.y.max-i.table.y.min,(i.table.y.max-i.table.y.min)/2,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:0,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.width.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.height.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.width.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.height.value;let i=this.calc(this.config.width.value,this.config.height.value);return this.path=i,i}calc(i,c){return[[-i/2,-c/2],[+i/2,-c/2],[+i/2,+c/2],[-i/2,+c/2],[-i/2,-c/2]]}}class Rhodonea{constructor(i){this.key="rhodonea",this.name="Rhodonea (Rose) Curve";let c=Math.min(i.table.x.max-i.table.x.min,i.table.y.max-i.table.y.min)/2;this.config={amplitude:{name:"Amplitude",value:null,input:{type:"createSlider",params:[0,c,c,1],class:"slider",displayValue:!0}},petals:{name:"Petal Value (k)",value:null,input:{type:"createSlider",params:[.5,20,5,.5],class:"slider",displayValue:!0}}},this.path=[]}draw(){this.config.amplitude.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.petals.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.amplitude.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.petals.value;let i=this.calc(this.config.amplitude.value,this.config.petals.value);return this.path=i,i}calc(i,c){var h,v,g=0,f=new Array,M=0;let e=2*Math.PI,n=500;for(;g<e;)g=M/n*e,h=i*Math.sin(c*g)*Math.cos(g),v=i*Math.sin(c*g)*Math.sin(g),f.push([h,v]),M++;return f}}var R,z;class ShapeMorph{constructor(i){H(this,R);this.key="shapemorph",this.name="Shape Morph",this.sides=60;let c=Math.min(i.table.x.max/2,i.table.y.max/2);this.circle=this.circleShape(this.sides,c),this.heart=this.heartShape(this.sides,c),this.star=this.starShape(this.sides,c),this.square=this.squareShape(this.sides,c),this.config={startShape:{name:"Inside Shape",value:"square",input:{type:"createSelect",options:{circle:"Circle",heart:"Heart",star:"Star",square:"Square"}}},endShape:{name:"Outside Shape",value:"circle",input:{type:"createSelect",options:{circle:"Circle",heart:"Heart",star:"Star",square:"Square"}}},revolutions:{name:"Revolutions",value:null,input:{type:"createSlider",params:[1,40,10,1],class:"slider",displayValue:!0}},twist:{name:"Twist",value:null,input:{type:"createSlider",params:[-1,1,0,.01],class:"slider",displayValue:!0}},completion:{name:"Completion",value:null,input:{type:"createSlider",params:[.1,1,.5,.1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.startShape.value=document.querySelector("#pattern-controls > div:nth-child(1) > select").value,this.config.endShape.value=document.querySelector("#pattern-controls > div:nth-child(2) > select").value,this.config.revolutions.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.revolutions.value,this.config.twist.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.twist.value,this.config.completion.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=100*this.config.completion.value+"%";let i=this.calc(this[this.config.startShape.value],this[this.config.endShape.value],this.sides,this.config.revolutions.value,this.config.completion.value,this.config.twist.value);return this.path=i,i}calc(i,c,h,v,g,f){var M,e;let n;var a=new Array,l=0;let r;const s=v*(2*Math.PI),o=(1-g)*s;let u=o;for(;u<s;)u=l/h*(2*Math.PI)+o,n=Math.floor(u/(2*Math.PI)),r=n/v,M=u/s*C(this,R,z).call(this,i[l%h][0],c[l%h][0],r),e=u/s*C(this,R,z).call(this,i[l%h][1],c[l%h][1],r),a.push(this.rotationMatrix(M,e,f*u/h)),a.push([M,e]),l++;return a.pop(),a}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}circleShape(i,c){let h=[];for(var v=0;v<=i+0;v++)h.push([c*Math.cos(v/i*2*Math.PI),-c*Math.sin(v/i*2*Math.PI)]);return h}heartShape(i,c){let h=[],v,g,f;for(var M=0;M<=i+0;M++)f=M/i*(2*Math.PI)+.5*Math.PI,v=10*(16*Math.pow(Math.sin(f),3)),g=10*(13*Math.cos(f)-5*Math.cos(2*f)-2*Math.cos(3*f)-Math.cos(4*f)),h.push([v,g]);return h}starShape(i,c){let h=[],v,g,f,M;for(var e=5,n=i/e,a=.4*c,l=0;l<=i;l++)f=l/i*(2*Math.PI),l%n==0?M=c:l%(n/2)==0?M=a:l%n<n/2?M=c-l%(n/2)/(n/2)*(c-a):M=a+l%(n/2)/(n/2)*(c-a),v=M*Math.cos(f),g=-M*Math.sin(f),h.push([v,g]);return h}squareShape(i,c){let h=i/8,v=[];for(var g=0;g<h;g++)v.push([c,-(g/h*c)]);h=i/4;for(var g=0;g<h;g++)v.push([c-g/h*(2*c),-c]);h=i/4;for(var g=0;g<h;g++)v.push([-c,-c+g/h*(2*c)]);h=i/4;for(var g=0;g<h;g++)v.push([-c+g/h*(2*c),c]);h=i/8;for(var g=0;g<h;g++)v.push([c,c-g/h*c]);return v.push([c,0]),v}}R=new WeakSet,z=function(i,c,h){return i+(c-i)*h};class ShapeSpin{constructor(){this.key="shapespin",this.name="Shape Spin",this.base_shape=[[-160,0],[80,-80],[160,0],[80,80],[-160,0]],this.config={steps:{name:"Steps",value:null,input:{type:"createSlider",params:[1,120,30,1],class:"slider",displayValue:!0}}},this.path=[]}draw(){this.config.steps.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.steps.value;let i=this.calc(this.base_shape,this.config.steps.value);return this.path=i,i}calc(i,c){var h=0,v=new Array,g=0;const f=2*Math.PI;for(;h<f;)h=g/c*(2*Math.PI),i.forEach(function(M){v.push(this.rotationMatrix(M[0],M[1],h))},this),g++;return v}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}translate(i,c){return i+c}}class Spiral{constructor(i){this.key="spiral",this.name="Spiral",this.env=i,this.config={sides:{name:"Sides",value:null,input:{type:"createSlider",params:[3,60,12,1],class:"slider",displayValue:!0}},revolutions:{name:"Revolutions",value:null,input:{type:"createSlider",params:[1,60,20,1],class:"slider",displayValue:!0}},start_r:{name:"Start Radius",value:null,input:{type:"createSlider",params:[0,1,0,.01],class:"slider",displayValue:!0}},start_theta:{name:"Start Theta",value:null,input:{type:"createSlider",params:[0,360,0,1],class:"slider",displayValue:!0}},twist:{name:"Twist",value:null,input:{type:"createSlider",params:[-1,1,0,.01],class:"slider",displayValue:!0}},noise:{name:"Noise",value:null,input:{type:"createSlider",params:[0,50,0,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.sides.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.revolutions.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.start_r.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.start_theta.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.twist.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(5) > input").value),this.config.noise.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(6) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.sides.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.revolutions.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.start_r.value.toFixed(2),document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.start_theta.value+"°",document.querySelector("#pattern-controls > div.pattern-control:nth-child(5) > span").innerHTML=this.config.twist.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(6) > span").innerHTML=this.config.noise.value;let i=this.calc(this.config.start_r.value,this.config.start_theta.value,this.config.revolutions.value,this.config.sides.value,this.config.twist.value,this.config.noise.value);return this.path=i,i}calc(i,c,h,v,g,f){for(var M,e,n,a,l=Math.min(this.env.table.x.max-this.env.table.x.min,this.env.table.y.max-this.env.table.y.min)/2,r=i*l*Math.cos(c*(Math.PI/180)),s=i*l*Math.sin(c*(Math.PI/180)),o=new Array,u=v*h,p=2*Math.PI*h,m,_=0;_<=u;_++)m=(u-_)/u*g*(2*Math.PI),a=_/u*p-m,n=l*(_/u),f>0&&_>0&&_<u&&(n-=f*Math.random()),M=n*Math.cos(a),e=n*Math.sin(a),M+=-r*(_/u)+r,e+=-s*(_/u)+s,o.push([M,e]);return o}}class Spokes{constructor(i){this.key="spokes",this.name="Spokes",this.env=i,this.config={spokes:{name:"Spokes",value:null,input:{type:"createSlider",params:[1,120,60,1],class:"slider",displayValue:!0}},waves:{name:"Waves",value:null,input:{type:"createSlider",params:[.5,10,4,.5],class:"slider",displayValue:!0}},amplitude:{name:"Amplitude",value:null,input:{type:"createSlider",params:[0,60,10,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.spokes.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.waves.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.amplitude.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.spokes.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.waves.value.toFixed(1),document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.amplitude.value;let i=this.calc(this.config.spokes.value,this.config.waves.value,this.config.amplitude.value);return this.path=i,i}calc(i,c,h){const v=this.env.table.x.max,g=this.env.table.y.max;for(var f,M,e=0,n=new Array,a=0,l=2*Math.PI/i,r=20*c,s=1;e<2*Math.PI;){e=a*l;for(var o=0;o<=r;o++)s>0?f=s*(Math.min(v,g)/2)*(o/r):f=-s*(Math.min(v,g)/2)*((r-o)/r),M=s*h*Math.sin(o/r*c*(2*Math.PI)),n.push(this.rotationMatrix(f,M,e));a++,s=s*-1}return n}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}}class Star{constructor(i){this.key="star",this.name="Star",this.env=i,this.config={points:{name:"Points",value:null,input:{type:"createSlider",params:[2,12,5,1],class:"slider",displayValue:!0}},pointiness:{name:"Pointiness",value:null,input:{type:"createSlider",params:[0,1,.5,.01],class:"slider",displayValue:!0}},revolutions:{name:"Revolutions",value:null,input:{type:"createSlider",params:[1,60,20,1],class:"slider",displayValue:!0}},twist:{name:"Twist",value:null,input:{type:"createSlider",params:[-1,1,0,.01],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.points.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.pointiness.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.revolutions.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.twist.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.points.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.pointiness.value.toFixed(2),document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.revolutions.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.twist.value.toFixed(2)+" Revs";let i=this.calc(0,0,0,0,this.config.revolutions.value,this.config.points.value,this.config.pointiness.value,this.config.twist.value);return this.path=i,i}calc(i,c,h,v,g,f,M,e){const n=this.env.table.x.min,a=this.env.table.x.max,l=this.env.table.y.min,r=this.env.table.y.max;for(var s,o,u=h,p=v,m=new Array,_=Math.min(a-n,r-l)/2,b=2*f,S=b*g,w=2*Math.PI*g,P,q=0;q<=S;q++)P=(S-q)/S*e*(2*Math.PI),p=q/S*w-P,u=h+(1-q%2*M)*(_*(q/S)),s=i+u*Math.cos(p),o=c+u*Math.sin(p),m.push([s,o]);return m}}class Superellipse{constructor(i){this.key="superellipse",this.name="Superellipse";let c=Math.min(i.table.x.max-i.table.x.min,i.table.y.max-i.table.y.min)/2;this.config={width:{name:"Width",value:null,input:{type:"createSlider",params:[0,.5*(i.table.x.max-i.table.x.min),c,1],class:"slider",displayValue:!0}},height:{name:"Height",value:null,input:{type:"createSlider",params:[0,.5*(i.table.y.max-i.table.y.min),c,1],class:"slider",displayValue:!0}},n:{name:"n-value",value:null,input:{type:"createSlider",params:[.1,10,1.5,.1],class:"slider",displayValue:!0}},spiralize:{name:"Spiralize",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:!0}],params:[0,1,1],displayValue:!1}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){this.config.width.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.height.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.n.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.spiralize.value=!1,document.querySelector("#pattern-controls > div:nth-child(4) > input[type=checkbox]").checked&&(this.config.spiralize.value=!0),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.width.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.height.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.n.value.toFixed(1);let i=this.calc(this.config.width.value,this.config.height.value,this.config.n.value,this.config.spiralize.value);return this.path=i,i}calc(i,c,h,v){var g,f,M=i,e=c,n=new Array;let a=60;if(v){M=0,e=0;for(var l=h,r=30,s=0;s<r;s++){var o=s/r*i,u=s/r*c;h=s/r*l+.1;for(var p=0;p<=2*Math.PI;p+=2*Math.PI/a)M=o+p/(2*Math.PI)*(i/r),e=u+p/(2*Math.PI)*(c/r),g=Math.pow(Math.abs(Math.cos(p)),2/h)*M*this.sgn(Math.cos(p)),f=Math.pow(Math.abs(Math.sin(p)),2/h)*e*this.sgn(Math.sin(p)),n.push([g,f])}}else for(var p=0;p<=2*Math.PI;p+=2*Math.PI/a)g=Math.pow(Math.abs(Math.cos(p)),2/h)*M*this.sgn(Math.cos(p)),f=Math.pow(Math.abs(Math.sin(p)),2/h)*e*this.sgn(Math.sin(p)),n.push([g,f]);return n}sgn(i){return i==0?0:i/Math.abs(i)}}class Text{constructor(i){this.key="text",this.name="Text",this.env=i,this.char_width=1.5*i.ball.diameter,this.char_height=this.char_width*2,this.line_height=2*this.char_height,this.config={scale:{name:"Scale",value:null,input:{type:"createSlider",params:[.8,1.2,1,.1],class:"slider",displayValue:!0}},text:{name:"Text",value:null,input:{type:"createTextarea",attributes:{rows:11,cols:22},value:`HELLO
WORLD`,params:[]}}},this.path=[]}draw(){let i=new Array;if(this.config.scale.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.text.value=document.querySelector("#pattern-controls > div:nth-child(2) > textarea").value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=Math.round(this.config.scale.value*100)+"%",this.config.text.value<1)return i=[[0,0]],i;this.char_width=1.5*this.env.ball.diameter*this.config.scale.value,this.char_height=2*this.char_width,this.line_height=2*this.char_height;let c=this.config.text.value.split(`
`),h=0,v=0;this.char_height;for(var g=0;g<c.length;g++){let e=c[g].length;for(var f=0;f<e;f++)i=i.concat(this.draw_character(h,v,c[g].charAt(f))),h+=this.char_width,f!=e-1&&(i.push([h,v]),h+=this.char_width,i.push([h,v]));g<c.length-1&&(i=i.concat([[h+.75*this.char_width,v],[h+.75*this.char_width,v-.5*this.char_height],[-.75*this.char_width,v-.5*this.char_height],[-.75*this.char_width,v-this.line_height],[0,v-this.line_height]]),h=0,v-=this.line_height)}var M=Math.max(...i.map(function(e,n){return e[0]}));return i=this.translate_path(i,-M/2,-this.char_height/2+(c.length-1)*this.line_height/2),i}draw_character(i,c,h){let v=new Array;switch(this.char_height,this.char_width,h=h.toUpperCase(),h){case" ":v=[[0,0],[1,0]];break;case`
`:v=[];break;case"A":v=[[0,0],[.5,1],[.75,.5],[.25,.5],[.75,.5],[1,0]];break;case"B":v=[[0,0],[0,1],[.75,1],[1,.875],[1,.625],[.75,.5],[0,.5],[.75,.5],[1,.325],[1,.125],[.75,0],[0,0]];break;case"C":v=[[0,0],[.25,0],[0,.25],[0,.75],[.25,1],[.75,1],[1,.75],[.75,1],[.25,1],[0,.75],[0,.25],[.25,0],[.75,0],[1,.25],[.75,0]];break;case"D":v=[[0,0],[0,1],[.25,1],[.75,1],[1,.75],[1,.25],[.75,0],[0,0],[.75,0]];break;case"E":v=[[0,0],[0,1],[1,1],[1,.875],[1,1],[0,1],[0,.5],[.75,.5],[0,.5],[0,0],[1,0],[1,.125],[1,0]];break;case"F":v=[[0,0],[0,1],[1,1],[1,.875],[1,1],[0,1],[0,.5],[.75,.5],[.75,.625],[.75,.375],[.75,.5],[0,.5],[0,0]];break;case"G":v=[[0,0],[.25,0],[0,.25],[0,.75],[.25,1],[.75,1],[1,.75],[.75,1],[.25,1],[0,.75],[0,.25],[.25,0],[.75,0],[1,.25],[1,.5],[.75,.5],[1,.5],[1,.25],[.75,0]];break;case"H":v=[[0,0],[0,1],[0,.5],[1,.5],[1,1],[1,0]];break;case"I":v=[[.25,0],[.5,0],[.5,1],[.25,1],[.75,1],[.5,1],[.5,0],[.25,0]];break;case"J":v=[[0,0],[.25,0],[0,.25],[.25,0],[0,0],[.5,0],[.75,.25],[.75,1],[.5,1],[1,1],[.75,1],[.75,.25],[.5,0],[1,0]];break;case"K":v=[[0,0],[0,1],[0,.5],[1,1],[0,.5],[1,0]];break;case"L":v=[[0,0],[0,1],[0,0],[1,0],[1,.125],[1,0]];break;case"M":v=[[0,0],[0,1],[.5,.5],[1,1],[1,0]];break;case"N":v=[[0,0],[0,1],[1,0],[1,1],[1,0]];break;case"O":v=[[0,0],[.25,0],[.75,0],[1,.25],[1,.75],[.75,1],[.25,1],[0,.75],[0,.25],[.25,0],[.75,0],[1,0]];break;case"P":v=[[0,0],[0,1],[.75,1],[1,.875],[1,.625],[.75,.5],[0,.5],[0,0]];break;case"Q":v=[[0,0],[.25,0],[.75,0],[1,.25],[1,.75],[.75,1],[.25,1],[0,.75],[0,.25],[.25,0],[.75,0],[.5,.25],[1,-.25],[.75,0],[1,0]];break;case"R":v=[[0,0],[0,1],[.75,1],[1,.875],[1,.625],[.75,.5],[0,.5],[.75,.5],[1,0]];break;case"S":v=[[.25,0],[0,.125],[.25,0],[.75,0],[1,.125],[1,.325],[.75,.5],[.25,.5],[0,.625],[0,.875],[.25,1],[.75,1],[1,.875],[.75,1],[.25,1],[0,.875],[0,.625],[.25,.5],[.75,.5],[1,.325],[1,.125],[.75,0]];break;case"T":v=[[0,0],[.5,0],[.5,1],[0,1],[1,1],[.5,1],[.5,0]];break;case"U":v=[[0,0],[.25,0],[0,.25],[0,1],[0,.25],[.25,0],[.75,0],[1,.25],[1,1],[1,.25],[.75,0]];break;case"V":v=[[0,0],[.5,0],[0,1],[.5,0],[1,1],[.5,0]];break;case"W":v=[[0,0],[0,1],[0,0],[.5,.5],[1,0],[1,1],[1,0]];break;case"X":v=[[0,0],[.5,.5],[0,1],[.5,.5],[1,1],[.5,.5],[1,0]];break;case"Y":v=[[0,0],[.5,0],[.5,.5],[0,1],[.5,.5],[1,1],[.5,.5],[.5,0]];break;case"Z":v=[[0,0],[1,1],[0,1],[1,1],[0,0],[1,0]];break;default:v=[[0,0],[0,1],[1,1],[1,0],[0,0],[1,0]]}return v.forEach(function(g,f,M){M[f][0]=g[0]*this.char_width,M[f][1]=g[1]*this.char_height},this),v=this.translate_path(v,i,c),v}translate_path(i,c,h){return i.forEach(function(v,g){this[g][0]+=c,this[g][1]+=h},i),i}}class ThetaRhoInput{constructor(i){this.key="thr",this.name="Theta Rho Coordinates",this.env=i;let c=`0 0.5
0.7854 0.7071
1.5708 0.5
2.3562 0.7071
3.1416 0.5
3.9270 0.7071
4.7124 0.5
5.4978 0.7071
6.2832 0.5
`;this.config={thr:{name:"Theta Rho",value:null,input:{type:"createTextarea",attributes:{rows:11,cols:30},value:c,params:[]}}},this.path=[]}draw(){this.config.thr.value=document.querySelector("#pattern-controls > div:nth-child(1) > textarea").value;let i=this.calc(this.config.thr.value);return this.path=i,i}calc(i){const c=this.env.table.x.min,h=this.env.table.x.max,v=this.env.table.y.min,g=this.env.table.y.max;let f=Math.min(h-c,g-v)/2,M=new Array,e=new Array;i.split(`
`).forEach(function(u){let p=u.match(/^([\+\-0-9\.]+)\s+([\+\-0-9\.]+)\s*$/);p&&M.push([parseFloat(p[1]),parseFloat(p[2])])}),e.push([f*M[0][1]*Math.cos(M[0][0]),f*M[0][1]*Math.sin(M[0][0])]);let a=M.length,l=60,r;for(var s=1;s<a;s++){let u=M[s][0]-M[s-1][0],p=M[s][1]-M[s-1][1];r=Math.abs(u*(180/Math.PI)/360*l);for(var o=0;o<r;o++)e.push([f*(M[s-1][1]+o/r*p)*Math.cos(M[s-1][0]+o/r*u),f*(M[s-1][1]+o/r*p)*Math.sin(M[s-1][0]+o/r*u)])}return e.push([f*M[a-1][1]*Math.cos(M[a-1][0]),f*M[a-1][1]*Math.sin(M[a-1][0])]),e=this.rotatePath(e,Math.PI/2),e=this.scalePath(e,[-1,1]),e}scalePath(i,c){return i.map(function(h){return[h[0]*c[0],h[1]*c[1]]})}rotatePath(i,c){return i.map(function(h){return[h[0]*Math.cos(c)-h[1]*Math.sin(c),h[0]*Math.sin(c)+h[1]*Math.cos(c)]})}}class WigglySpiral{constructor(i){this.key="wigglyspiral",this.name="Wiggly Spiral",this.env=i,this.config={offset:{name:"Offset",value:null,input:{type:"createSlider",params:[2,40,20,1],class:"slider",displayValue:!0}},amplitude:{name:"Amplitude",value:null,input:{type:"createSlider",params:[1,10,5,.1],class:"slider",displayValue:!0}},wiggles:{name:"Wiggles/Rev",value:null,input:{type:"createSlider",params:[0,40,20,.1],class:"slider",displayValue:!0}}},this.path=[]}draw(){const i=this.env.table.y.max;this.config.offset.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(1) > input").value),this.config.amplitude.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.wiggles.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(1) > span").innerHTML=this.config.offset.value+" "+this.env.table.units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.amplitude.value.toFixed(1)+" "+this.env.table.units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.wiggles.value;let c=this.calc(0,0,.9*(i/2),0,this.config.offset.value,this.config.amplitude.value,this.config.wiggles.value);return this.path=c,c}calc(i,c,h,v,g,f,M){this.env.table.x.max,this.env.table.y.max;for(var e,n,a=h,l=v,r=new Array,s=0,o=1/300;a>0;)l=s*o*(2*Math.PI),a=h-g*(s*o),a=a-f*Math.sin(M*l),e=i+a*Math.cos(l),n=c+a*Math.sin(l),r.push([e,n]),s++;return r}}class ZigZag{constructor(i){this.key="zigzag",this.name="Zig Zag",this.env=i,this.config={bound:{name:"Bounding Shape",value:null,input:{type:"createSelect",options:{rectangle:"Max Rectangle",circle:"Max Circle"}}},spacing:{name:"Spacing",value:null,input:{type:"createSlider",params:[-((i.table.y.max-i.table.y.min)/2),-1,-.5*((i.table.y.max-i.table.y.min)/2),1],class:"slider",displayValue:!0}},margin:{name:"Margin",value:null,input:{type:"createSlider",params:[0,Math.min(i.table.x.max-i.table.x.min,i.table.y.max-i.table.y.min)/10,0,1],class:"slider",displayValue:!0}},rotation:{name:"Rotation",value:null,input:{type:"createSlider",params:[-180,180,0,1],class:"slider",displayValue:!0}},border:{name:"Border",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:!0}],params:[0,1,0],displayValue:!1}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){const i=this.env.table.y.min,c=this.env.table.y.max;this.config.bound.value=document.querySelector("#pattern-controls > div:nth-child(1) > select").value,this.config.spacing.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.config.margin.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.rotation.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),this.config.border.value=0,document.querySelector("#pattern-controls > div:nth-child(5) > input[type=checkbox]").checked&&(this.config.border.value=1),document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=((c-i)/-this.config.spacing.value).toFixed(1)+" "+this.env.table.units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.margin.value+" mm",document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.rotation.value+"°";let h=this.calc((c-i)/-this.config.spacing.value,this.config.margin.value,0,this.config.border.value,this.config.bound.value);return h=h.map(function(v){return this.rotationMatrix(v[0],v[1],this.config.rotation.value*(Math.PI/180))},this),this.path=h,h}calc(i,c,h,v,g){const f=this.env.table.x.min,M=this.env.table.x.max,e=this.env.table.y.min,n=this.env.table.y.max;for(var a=-(M/2-c),l=-(n/2-c),r=a,s=l,o=new Array,u=0;s+i<=n/2-c;)g=="circle"?u%4==0?r=Math.sqrt(Math.pow(190,2)-Math.pow(s,2)):u%4==1?(s=s+i,r=Math.sqrt(Math.pow(190,2)-Math.pow(s,2))):u%4==2?r=-Math.sqrt(Math.pow(190,2)-Math.pow(s,2)):u%4==3&&(s=s+i,r=-Math.sqrt(Math.pow(190,2)-Math.pow(s,2))):u%4==0?r=(M-f)/2-c:u%4==2?r=-(M-f)/2+c:s=s+i,o.push([r,s]),u++;if(v)if(g=="circle")for(var p=0;p<2*Math.PI;p+=2*Math.PI/60)o.push([.5*(n-e)*Math.cos(p+.5*Math.PI),.5*(n-e)*Math.sin(p+.5*Math.PI)]);else r<0?(o.push([M/2-c,s]),o.push([M/2-c,l]),o.push([r,l]),o.push([r,s])):(o.push([+((M-f)/2-c),l]),o.push([-((M-f)/2-c),l]),o.push([-((M-f)/2-c),s]),o.push([r,s]));return o}rotationMatrix(i,c,h){return[i*Math.cos(h)-c*Math.sin(h),i*Math.sin(h)+c*Math.cos(h)]}}const app_version=env.app.version,units=env.table.units,min_x$1=env.table.x.min,max_x$1=env.table.x.max,min_y$1=env.table.y.min,max_y$1=env.table.y.max,motor_speed=env.motor.speed,ball_size=env.ball.diameter;var coordinate_overlay=!0,distance,draw_iteration=0,gCodeCommand=env.gcode.command,plotter_format_select,pattern_select,previous_pattern,path;let path_preview;var recalculate_pattern=env.recalculate_pattern,Patterns={coordinates:new Coordinates,circle:new Circle(env),cross:new Cross(env),cycloid:new Cycloid(env),diameters:new Diameters(env),draw:new Draw(env),egg:new Egg(env),farris:new Farris(env),fermatspiral:new FermatSpiral,fibonacci:new Fibonacci(env),fibonaccilollipops:new FibonacciLollipops(env),frame:new Frame(env),gcode:new Gcode(env),gravity:new Gravity(env),heart:new Heart,lindenmayer:new Lindenmayer(env),lissajous:new Lissajous(env),parametric:new Parametric,rectangle:new Rectangle(env),rhodonea:new Rhodonea(env),shapemorph:new ShapeMorph(env),shapespin:new ShapeSpin,spiral:new Spiral(env),logspiral:new LogarithmicSpiral(env),spokes:new Spokes(env),star:new Star(env),superellipse:new Superellipse(env),text:new Text(env),thr:new ThetaRhoInput(env),wigglyspiral:new WigglySpiral(env),zigzag:new ZigZag(env)};const PathHelp=new PathHelper;new p5(d=>{d.setup=()=>{env.app.framerate&&!isNaN(env.app.framerate)&&d.frameRate(env.app.framerate),d.createCanvas(env.canvas.width,env.canvas.height).parent("canvas-holder");var f=d.createDiv("<label>Pattern</label>").parent("pattern-selector");pattern_select=d.createSelect().parent(f).attribute("name","pattern"),document.querySelector("#pattern-selector > div > select");const M=Object.entries(Patterns);for(const[l,r]of M)pattern_select.option(r.name,r.key);pattern_select.selected("spiral"),pattern_select.changed(c);var e=localStorage.getItem("lastPattern");e&&pattern_select.selected(e);let n=d.getURLParams();n.pattern&&pattern_select.selected(n.pattern),previous_pattern=pattern_select.value(),loadPatternConfig(pattern_select.value()),plotter_format_select=d.createSelect().attribute("name","TBD").parent("#plotter-format"),plotter_format_select.option("Cartesian","cartesian"),plotter_format_select.option("Polar","polar"),plotter_format_select.selected(localStorage.getItem("format")??env.table.format),plotter_format_select.changed(function(){i(),localStorage.setItem("format",plotter_format_select.value())}),i(),d.createButton("Download").parent("download").mousePressed(g),c(!1)},d.draw=()=>{d.background(68);var f=pattern_select.value();f=="draw"&&(recalculate_pattern=!0,env.mouse.pressed&&(env.mouse.x=d.mouseX,env.mouse.y=d.mouseY)),recalculate_pattern&&(path=Patterns[f].draw(),path_preview=PathHelp.dividePathComplete(path,10),recalculate_pattern=env.recalculate_pattern),document.querySelector("#pattern-controls input[name=reverse]")&&(Patterns[f].config.reverse.value=document.querySelector("#pattern-controls input[name=reverse]").checked,Patterns[f].config.reverse.value&&path.reverse()),typeof Patterns[f].path_sampling_optimization<"u"&&(path=optimizePath(path,Patterns[f].path_sampling_optimization)),h(path_exceeds_plotter(path)),v(path_preview,2,!1,!0,coordinate_overlay),distance=0;for(let M=1;M<path.length;M++)distance+=Math.sqrt(d.pow(path[M][0]-path[M-1][0],2)+d.pow(path[M][1]-path[M-1][1],2));d.select("#pattern-instructions").html(d.nfc(path.length)),d.select("#pattern-distance").html(d.nfc(distance,1)+" "+units),d.select("#pattern-time").html(d.nfc(distance/motor_speed,1)+" minutes"),draw_iteration++},d.mousePressed=()=>{env.mouse.pressed=!0},d.mouseReleased=()=>{env.mouse.pressed=!1};function i(){env.table.format=plotter_format_select.value(),env.table.format=="cartesian"?(d.select("#plotter-max_x").html(min_x$1+" - "+max_x$1+" "+units),d.select("#plotter-max_y").html(min_y$1+" - "+max_y$1+" "+units)):(d.select("#plotter-max_x").html("NA"),d.select("#plotter-max_y").html("NA")),d.select("#plotter-motor_speed").html(motor_speed+" "+units+"/min"),d.select("#plotter-ball_size").html(ball_size+" "+units)}function c(f=!0){d.select("#pattern-controls").html("");var M=pattern_select.value();localStorage.setItem("lastPattern",M),loadPatternConfig(M),f&&savePatternConfig(previous_pattern),previous_pattern=M;let e=new Array;const n=Object.entries(Patterns[M].config);for(const[l,r]of n){var a=new Object;if(a.div=d.createDiv("<label>"+r.name+"</label>").parent("pattern-controls").addClass("pattern-control"),r.input.type=="createSelect"){a.input=d.createSelect().attribute("name",l).parent(a.div).addClass(r.input.class);const s=Object.entries(r.input.options);for(const[o,u]of s)a.input.option(u,o);r.value&&a.input.selected(r.value)}else r.input.type=="createSlider"?a.input=d.createSlider(r.input.params[0],r.input.params[1],r.value?r.value:r.input.params[2],r.input.params[3]).attribute("name",l).parent(a.div).addClass(r.input.class):r.input.type=="createCheckbox"?(a.input=d.createInput(r.input.params[0],r.input.params[1],r.input.params[2]).attribute("type","checkbox").attribute("name",l).attribute("checkbox",null).parent(a.div),(r.input.params[2]==1||r.value)&&a.input.attribute("checked","checked")):r.input.type=="createInput"?a.input=d.createInput(r.value?r.value:r.input.params[0],r.input.params[1]).attribute("name",l).parent(a.div):r.input.type=="createTextarea"&&(a.input=d.createElement("textarea",r.value?r.value:r.input.value).attribute("rows",r.input.attributes.rows).attribute("cols",r.input.attributes.cols).attribute("name",l).parent(a.div));a.input.changed(function(){f=!0}),r.input.displayValue&&d.createSpan("0").parent(a.div),e.push(a)}document.title="Sand Pattern | "+Patterns[M].name,Patterns[pattern_select.value()]!==void 0&&updateURL(pattern_select.value())}function h(f=!1){let M=Math.min(env.table.x.max-env.table.x.min,env.table.y.max-env.table.y.min)/2;d.noStroke(),d.rectMode(d.CENTER),d.fill(220,220,220),d.rect(d.width/2,d.height/2,d.width,d.height),d.rectMode(d.CENTER),d.stroke(200),f&&d.stroke(255,0,0,128),d.strokeWeight(1),d.fill(215,215,215),env.table.format=="cartesian"?d.rect(d.width/2,d.height/2,max_x$1/648*d.width,max_y$1/648*d.height):env.table.format=="polar"&&d.ellipse(d.width/2,d.height/2,2*M,2*M),d.stroke(210),d.line(d.width/2,0,d.width/2,d.height),d.line(0,d.height/2,d.width,d.height/2),d.noStroke(),env.table.format=="polar"&&(d.stroke(200),d.noFill(),d.ellipse(d.width/2,d.height/2,Math.min(max_x$1-min_x$1,max_y$1-min_y$1),Math.min(max_x$1-min_x$1,max_y$1-min_y$1)),d.noStroke(),d.fill(128,128,128),d.textAlign(d.LEFT),d.text("[1, 0]",d.width/2+Math.min(max_x$1-min_x$1,max_y$1-min_y$1)/2+2,d.height/2+4),d.textAlign(d.CENTER),d.text("[1, π/2]",d.width/2,M-60)),env.table.format=="cartesian"&&(d.noStroke(),d.fill(128,128,128),d.textAlign(d.LEFT),d.text("[0,0]",d.width/2-(max_x$1-min_x$1)/2,d.height/2+(max_y$1-min_y$1)/2+12),d.textAlign(d.RIGHT),d.text("["+max_x$1+","+max_y$1+"]",d.width/2+(max_x$1-min_x$1)/2,d.height/2-(max_y$1-min_y$1)/2-4))}function v(f,M=1,e=!0,n=!0,a=!1){const l=env.table.x.max,r=env.table.x.min,s=env.table.y.max,o=env.table.y.min;d.noFill(),d.stroke(128,164,200),d.strokeCap(d.ROUND),d.strokeWeight(M);const u=Math.min(l-r,s-o)/2;d.push(),d.scale(1,-1),d.translate(d.width/2,-d.height/2);let p=f.length;n&&(p=draw_iteration%f.length),d.stroke(240,240,240),d.beginShape();for(var m=0;m<f.length;m++)d.vertex(f[m][0],f[m][1]);if(d.endShape(),a){if(env.table.format=="cartesian"&&(d.stroke(0,0,0,16),d.line(-(l-r)/2+ball_size/2,f[p][1],(l-r)/2,f[p][1]),d.fill(0,0,0,16),d.noStroke(),d.triangle(-(l-r)/2,f[p][1]-ball_size/2,-(l-r)/2,f[p][1]+ball_size/2,-(l-r)/2+ball_size/2,f[p][1]),d.stroke(0,0,0,16),d.line(f[p][0],(s-o)/2,f[p][0],-(s-o)/2+ball_size/2),d.fill(0,0,0,16),d.noStroke(),d.triangle(f[p][0]+ball_size/2,-(s-o)/2,f[p][0]-ball_size/2,-(s-o)/2,f[p][0],-(s-o)/2+ball_size/2)),env.table.format=="polar"){d.stroke(0,0,0,16);let _=Math.min(l-r,s-o)/2,b=Math.atan2(f[p][1],f[p][0]);d.line((_-ball_size/2)*Math.cos(b),(_-ball_size/2)*Math.sin(b),-_*Math.cos(b),-_*Math.sin(b)),d.fill(0,0,0,16),d.noStroke(),d.triangle((_-ball_size/2)*Math.cos(b),(_-ball_size/2)*Math.sin(b),_*Math.cos(b+1/60*Math.PI),_*Math.sin(b+1/60*Math.PI),_*Math.cos(b-1/60*Math.PI),_*Math.sin(b-1/60*Math.PI))}if(d.noStroke(),d.fill(128),d.push(),d.scale(1,-1),env.table.format=="cartesian")d.textAlign(d.CENTER),d.text((f[p][0]+(l-r)/2).toFixed(1),f[p][0],(s-o)/2+12),d.textAlign(d.RIGHT),d.text((f[p][1]+(s-o)/2).toFixed(1),-((l-r)/2+2),-(f[p][1]-4));else if(env.table.format=="polar"){d.textAlign(d.LEFT);let _=Math.sqrt(Math.pow(f[p][0],2)+Math.pow(f[p][1],2))/u,b=Math.atan2(f[p][1],f[p][0]);b<0&&(b=b+2*Math.PI),d.textAlign(d.RIGHT),d.text("rho: "+_.toFixed(2)+`
theta: `+b.toFixed(2),u,u-40)}d.pop()}if(e){d.stroke(46,200,240),d.beginShape();for(var m=0;m<=p;m++)d.vertex(f[m][0],f[m][1]);d.endShape(),d.noStroke(),n&&(d.fill(255,255,0,128),d.ellipse(f[p][0],f[p][1],ball_size/2,ball_size/2))}else{let _=d.color(128,24*d.cos(m/f.length*d.TWO_PI)+164,200);for(var m=0;m<p;m++)d.stroke(250),d.strokeCap(d.SQUARE),d.strokeWeight(M*4),d.line(f[m][0],f[m][1],f[m+1][0],f[m+1][1]),d.strokeCap(d.PROJECT),d.strokeWeight(M),d.stroke(_),d.line(f[m][0],f[m][1],f[m+1][0],f[m+1][1]);d.noStroke(),n&&(d.fill(_),d.ellipse(f[p][0],f[p][1],ball_size/2,ball_size/2))}d.noStroke(),d.fill(0,255,0,128),d.ellipse(f[0][0],f[0][1],ball_size/2,ball_size/2),d.noStroke(),d.fill(255,0,0,128),d.ellipse(f[f.length-1][0],f[f.length-1][1],ball_size/2,ball_size/2),d.pop()}function g(){let f="pattern";var M=pattern_select.value();if(Patterns[M]!==void 0&&(f+="-"+Patterns[M].key),env.table.format=="cartesian")d.save(createGcode(env,Patterns[M],path,gCodeCommand),f,"gcode");else if(env.table.format=="polar"){let e=new thetaRho(env);d.save(e.convert(path),f,"thr")}}});function path_exceeds_plotter(d){const i=(v,g)=>v.map(f=>f[g]),c=i(d,0),h=i(d,1);return Math.min(...c)<-((max_x$1-min_x$1)/2)||Math.max(...c)>max_x$1/2||Math.min(...h)<-((max_y$1-min_y$1)/2)||Math.max(...h)>max_y$1/2}function optimizePath(d,i){var c=new Array;return c.push(d[0]),d.forEach(function(h,v){var g=c[c.length-1],f=Math.sqrt(Math.pow(h[0]-g[0],2)+Math.pow(h[1]-g[1],2));f>i&&c.push(h)}),c}function updateURL(d){let i="?pattern="+d;Object.entries(Patterns[d].config),history.replaceState({id:"homepage"},document.title,i)}function savePatternConfig(d){localStorage.setItem("appVersion",app_version),localStorage.setItem("lastSaved",new Date),localStorage.setItem("v"+app_version+"_"+d,JSON.stringify(Patterns[d].config))}function loadPatternConfig(d){var i=JSON.parse(localStorage.getItem("v"+app_version+"_"+d));i&&(Patterns[d].config=i)}
